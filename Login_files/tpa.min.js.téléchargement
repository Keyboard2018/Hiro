var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}define("tpa/common/tpaMetaData",[],function(){"use strict";var e="14517e1a-3ff0-af98-408e-2bd6953c36a2";return{PERMITTED_GLUED_TPAS_IN_MOBILE:[e],PERMITTED_FULL_SCREEN_TPAS_IN_MOBILE:[e]}}),define("tpa/bi/errors.json",[],function(){return{SDK_SET_HEIGHT_ERROR:{errorCode:190,desc:"sdk - set height with a big number",severity:"error",params:{p1:"height"}},SDK_PUBSUB_PUBLISH_ERROR:{errorCode:191,desc:"sdk - pubSub: publish error. App not installed on site - cannot find appDefId",severity:"error"},SDK_NAVIGATION_TO_SECTION_ERROR:{errorCode:192,desc:"sdk - navigate to section failed",severity:"error",params:{p1:"appDefinitionName",p2:"sectionId"}},ECOM_MISSING_PAGES:{errorCode:300,desc:"missing ecom pages",severity:"error"},APP_IS_NOT_RESPONSIVE:{errorCode:302,desc:"monitoring apps that are down",severity:"error",params:{p1:"endpoint",p2:"app_id",p3:"pageNo",p4:"totalLoadingTime"}}}}),define("tpa/bi/errors",["tpa/bi/errors.json","lodash","utils"],function(e,t,i){"use strict";var a=i.logger;return t.forEach(e,function(e,t){e.errorName=t}),a.register("tpa","error",e),e}),define("tpa/utils/tpaUtils",["lodash","coreUtils"],function(e,t){"use strict";var i={CAMERA:"camera",MICROPHONE:"microphone",LOCATION:"geolocation",VR:"vr"},a=function(e,t){var i=e.getComponentById(t);return i&&e.getSiteData().getClientSpecMapEntry(i.props.compData.applicationId)},n=function(e){return e.getSiteData().getClientSpecMap()},s=function(e){var t=e&&e.instance.split(".")[1];return t&&JSON.parse(window.atob(t))},o=0,r=function(){0===o&&(o=1e3)};return{Constants:{TPA_PUB_SUB_PREFIX:"TPA_PUB_SUB_",MULTI_SECTION_DELIMITER:"$TPA$",TOP_PAGE_ANCHOR_PREFIX:"TOP_PAGE_"},getCacheKiller:t.urlUtils.persistentCacheKiller,getAppData:a,getAppDataByAppDefinitionId:function(t,i){var a=n(t);return e.find(a,{appDefinitionId:i})},getAppDefId:function(e,t){var i=a(e,t);return i?i.appDefinitionId:null},stripPubSubPrefix:function(e){var t=new RegExp("^TPA_PUB_SUB_");return e.replace(t,"")},addPubSubEventPrefix:function(e){return"TPA_PUB_SUB_".concat(e)},isTPASection:function(t){var i=e.get(t,"props.structure.componentType")||e.get(t,"componentType");return"wysiwyg.viewer.components.tpapps.TPASection"===i||"wysiwyg.viewer.components.tpapps.TPAMultiSection"===i},isGluedWidget:function(t){return"wysiwyg.viewer.components.tpapps.TPAGluedWidget"===(e.get(t,"props.structure.componentType")||e.get(t,"componentType"))},sdkVersionIsAtLeast:function(t,i){t=t||"0.0.0",i=i||"1.41.0";var a=e.map(t.split("."),function(e){return parseInt(e,10)}),n=e.map(i.split("."),function(e){return parseInt(e,10)});return 3===a.length&&3===n.length&&a[0]>=n[0]&&a[1]>=n[1]&&a[2]>=n[2]},getVisitorUuid:function(t){var i=t.cookieUtils.getCookie("_wixUIDX")||"";return i=(i=i.slice(e.lastIndexOf(i,"|")+1)).replace(/^(null-user-id|null)$/g,"")},getInstanceFromClientSpecMap:function(e,t){return s(e[t])},getInstanceFromAppData:s,getClientSpecMap:n,incAppCounter:function(){++o},decAppCounter:function(e,t){--o,r(e,t)},reportAppCounter:r,isPageMarkedAsHideFromMenu:function(t,i){if(t&&i){e.includes(i,"$TPA$")&&(i=i.substr(0,i.indexOf("$TPA$")));var a=e.find(t.widgets,function(t){return e.get(t,"appPage.id")===i});return!!a&&e.get(a,"appPage.hideFromMenu")}return!1},getDebuggingParamsFromUrl:function(t){var i={},a=e.get(t,"query.petri_ovr");a&&(i.petri_ovr=a);var n=e.get(t,"query.debugApp");return n&&(i.debugApp=n),i},appendProtocolToUrlIfNeeded:function(i,a){if(!/^https?/.test(i)){var n=e.get(a,"protocol","http:");return t.urlUtils.addProtocolIfMissing(i,n)}return i},getIFramePermissions:function(){return e(i).values().join("; ")}}}),define("tpa/services/clientSpecMapService",["lodash","coreUtils","tpa/utils/tpaUtils"],function(e,t,i){"use strict";var a=t.clientSpecMapUtils.getMainSectionWidgetData,n=function(t,i,a){var n=t.getClientSpecMap()[i];if(n){var s=e.find(n.widgets,function(e){return e.appPage&&e.appPage.id===a});if(s)return s.shouldBeStretchedByDefaultMobile||s.appPage.landingPageInMobile||s.appPage.fullPage}return!1};return{getAppDataByAppDefinitionId:function(t,i){var a=t.getClientSpecMap();return e.find(a,{appDefinitionId:i})},getMainSectionWidgetData:a,isSuperAppByCompId:function(t,a){var n=i.getAppData(t,a);return e.get(n,"isWixTPA")},isCurrentPageFullResponsive:function(e){return e.isMobileDevice()&&e.isMobileView()&&!!function(e){var t=e.getCurrentUrlPageId(),i=e.getDataByQuery(t);return!!(i&&"Page"===i.type&&i.tpaApplicationId>0)&&n(e,i.tpaApplicationId,i.tpaPageId)}(e)},getWidgetDataByTpaPageId:function(t,i){var a=e.get(t,"widgets");return e.find(a,function(t){return e.get(t,"appPage.id")===i})},isFullPage:function(t,i){if(i){var n=e.get(t,"widgetId"),s=n?e.get(i.widgets,n):a(i);return e.get(s,"appPage.fullPage",!1)}return!1}}}),define("tpa/bi/events.json",[],function(){return{JS_SDK_FUNCTION_CALL:{eventId:12,adapter:"sdk",src:11,sampleRatio:1e3,params:{visitor_id:"visitorUuid",ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",app_id:"appId",instance_id:"instanceId",is_published:"isPublished",count:"count",param:"param"}},GALLERY_FUNCTION_CALL:{eventId:11,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",count:"count"}},APP_IFRAME_START_LOADING:{eventId:642,src:42,params:{widget_id:"widgetId",widget_name:"widgetName",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime",pid:"pageId",pn:"pageNo",tts:"totalLoadingTime",external_app_id:"externalAppDefinitionId",external_widget_id:"externalWidgetId"}},APP_LOADED_SUCCESSFULLY:{eventId:643,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime",pid:"pageId",pn:"pageNo",tts:"totalLoadingTime",external_app_id:"externalAppDefinitionId",external_widget_id:"externalWidgetId"}},APP_LOADED_PARTIALLY:{eventId:644,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime",stage:"stage",stage_number:"stageNum",pid:"pageId",pn:"pageNo",tts:"totalLoadingTime",external_app_id:"externalAppDefinitionId",external_widget_id:"externalWidgetId"}},APP_SDK_START_LOADING:{eventId:645,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime",pid:"pageId",pn:"pageNo",tts:"totalLoadingTime",external_app_id:"externalAppDefinitionId",external_widget_id:"externalWidgetId"}},APP_STATE_CHANGED:{eventId:646,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime",pid:"pageId",pn:"pageNo",tts:"totalLoadingTime",external_app_id:"externalAppDefinitionId",external_widget_id:"externalWidgetId"}},RELOAD_TPA_CLICK:{eventId:321,src:42,params:{app_id:"appDefinitionId",appName:"appName"}}}}),define("tpa/bi/events",["tpa/bi/events.json","lodash","utils"],function(e,t,i){"use strict";return i.logger.register("tpa","event",e),e}),define("tpa/mixins/tpaCompBaseMixin",["zepto","core","prop-types","lodash","reactDOM","santaComponents","santaProps","tpa/common/tpaMetaData","tpa/bi/errors","tpa/services/clientSpecMapService","tpa/utils/tpaUtils","tpa/bi/events"],function(e,t,i,a,n,s,o,r,p,c,d,l){"use strict";var u=s.santaTypesDefinitions,g={mobile:"unavailableInMobile",https:"unavailableInHttps"},m=function(e,t){var i={charCode:e.charCode,keyCode:e.keyCode};this.sendPostMessage({intent:"addEventListener",eventType:t,params:i})},h=function(e){return!e.rootId||a.includes(e.getRootIdsWhichShouldBeRendered(),e.rootId)},f=a.throttle(function(e){if(h(this.props)){var t=function(e,t,i){var n=void 0,s={x:(n=v(e.props)?e._cachedBoundingClientRect:e._domNode.getBoundingClientRect()).left+(t.x||0),y:n.top+(t.y||0),width:n.width,height:n.height};s.scale=i,null===e.windowSize&&(e.windowSize=e.props.screenSize);var o={scrollTop:t.y,scrollLeft:t.x,documentHeight:e.props.screenSize.height,documentWidth:e.props.screenSize.width};return a.assign({},s,n,o)}(this,e,a.get(this,"props.siteScale",1));this.sendPostMessage({intent:"addEventListener",eventType:"SCROLL",params:t})}},250,{trailing:!0});function v(e){return a.get(e,"structure.layout.fixedPosition")||!1}var I=function(e){var t=e.getClientSpecMapEntry(e.compData.applicationId);return a.includes(r.PERMITTED_FULL_SCREEN_TPAS_IN_MOBILE,a.get(t,"appDefinitionId"))};return{propTypes:{pageStub:u.Component.pageStub,isMobileView:o.Types.isMobileView,isViewerMode:o.Types.isViewerMode,currentUrl:o.Types.currentUrl.isRequired,compData:o.Types.Component.compData.isRequired,style:o.Types.Component.style.isRequired,id:o.Types.Component.id.isRequired,getMemberDetails:o.Types.SiteMembersSantaTypes.getMemberDetails.isRequired,windowResizeEvent:o.Types.SiteAspects.windowResizeEvent.isRequired,reportBI:o.Types.reportBI.isRequired,biData:o.Types.biData.isRequired,compProp:o.Types.Component.compProp,primaryPageId:o.Types.primaryPageId.isRequired,getRootIdsWhichShouldBeRendered:o.Types.getRootIdsWhichShouldBeRendered,reportBeatEvent:o.Types.reportBeatEvent.isRequired,santaBase:o.Types.santaBase.isRequired,getClientSpecMapEntry:o.Types.getClientSpecMapEntry.isRequired,dynamicClientSpecMapAspect:o.Types.SiteAspects.dynamicClientSpecMapAspect.isRequired,clientSpecMap:o.Types.RendererModel.clientSpecMap.isRequired,languageCode:o.Types.RendererModel.languageCode,pageId:o.Types.Component.pageId,rootId:o.Types.Component.rootId,structure:o.Types.Component.structure,siteScale:o.Types.RenderFlags.siteScale,screenSize:o.Types.screenSize.isRequired,tpaComponentsDomAspect:o.Types.SiteAspects.tpaComponentsDomAspect.isRequired,isExperimentOpen:o.Types.isExperimentOpen,getExistingRootNavigationInfo:o.Types.getExistingRootNavigationInfo.isRequired,currentUrlPageId:o.Types.Component.currentUrlPageId.isRequired},mixins:[t.compMixins.createChildComponentMixin],ALIVE_TIMEOUT:2e4,OVERLAY_GRACE:5e3,statics:{compSpecificIsDomOnlyOverride:function(){return!1}},onScroll:f,onResize:function(){v(this.props)&&(this._cachedBoundingClientRect=this._domNode.getBoundingClientRect())},onKeyDown:function(e){h(this.props)&&m.call(this,e,"KEY_DOWN")},onKeyUp:function(e){h(this.props)&&m.call(this,e,"KEY_UP")},isUnderMobileView:function(){return this.props.isMobileView},getEcomParams:function(){return"1380b703-ce81-ff05-f115-39571d94dfcd"===this.getAppData().appDefinitionId&&this.props.currentUrl.query["ecom-tpa-params"]},_createOverlayChildComponent:function(e,t,i,n){return n=n||{},this.createChildComponent(a.merge(n,{id:i,style:this.props.style,overlay:t,applicationId:this.props.compData.applicationId,hideOverlayFunc:this._hideOverlay,reloadFunc:this._reload,compData:this.props.compData,languageCode:this.props.languageCode,santaBase:this.props.santaBase,getClientSpecMapEntry:this.props.getClientSpecMapEntry}),e,i,{})},_hideOverlay:function(){this.setState({showOverlay:!1})},_getUnresponsiveText:function(){return this.isUnderMobileView()?"Can't see the content? ":"To view this content, click "},_getReloadext:function(){return this.isUnderMobileView()?"Tap to reload.":"reload."},_createOverlay:function(e){if(!e)return null;switch(e){case"preloader":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",e,"preloaderOverlay");case"unresponsive":var t=void 0;return t=this.props.isExperimentOpen("sv_tpaReloadUnresponsiveIframe")?{text:this._getUnresponsiveText(),reload:this._getReloadext()}:{text:"We're sorry, this content cannot be displayed. Please try again later."},this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",e,"unavailableMessageOverlay",t);case g.https:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",e,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed."});case g.mobile:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",e,"unavailableMessageOverlay",{text:"We're sorry, this content is currently not optimized for mobile view."});default:return null}},_getWidgetName:function(){var e=a.get(this.props.compData,"widgetId"),t=this.getAppData(),i=e?a.get(t.widgets,e):c.getMainSectionWidgetData(t);return a.get(i,"appPage.name")||t.appDefinitionName},_getTpaPageId:function(){var e=a.get(this.props.compData,"widgetId"),t=this.getAppData(),i=e?a.get(t.widgets,e):c.getMainSectionWidgetData(t);return i&&i.appPage?a.get(i,"appPage.id"):a.get(i,"tpaWidgetId")},getRootStyle:function(e){var t="hidden"===this.state.visibility?{visibility:this.state.visibility}:{};return a.assign({minHeight:e.height,minWidth:e.width},t,e)},getCompRootStyle:function(e){if(e=a.clone(e),this.isUnderMobileView()){if(this.state.isMobileFullScreenMode)return{display:"block"};if(I(this.props))return{display:"none"}}return this.state&&!a.isUndefined(this.state.height)&&(e.height=this.state.height),this.state&&!a.isUndefined(this.state.width)&&(e.width=this.state.width),this.state&&(this.state.isAlive||"preloader"===this.state.overlay||"unresponsive"===this.state.overlay||this.state.overlay===g.mobile)&&(this.state.visibility="visible"),this.state.ignoreAnchors?e.zIndex=1001:e.zIndex="",e=this.getRootStyle(e)},shouldRenderIframe:function(){var e=this.state.overlay,t=!a.includes(g,e),i="unresponsive"===this.state.overlay,n=t&&!i&&this._isCompInClientSpecMap();return n},_getIframeProperties:function(){if(!this.shouldRenderIframe())return null;var e=this._shouldShowIframe(this.state),t=this.buildUrl(this.getBaseUrl()),i=this._getWidgetName(),n={"data-src":t,key:t,scrolling:c.isFullPage(this.props.compData,this.getAppData())?"yes":"no",frameBorder:"0",allow:d.getIFramePermissions(),allowtransparency:"true",allowFullScreen:!0,name:this.props.id,style:{display:e?"block":"none",width:"100%",height:"100%",overflow:"hidden",position:"absolute"},title:i,"aria-label":i};if(this.props.isExperimentOpen("sv_renderEcomSeoIframeSrc")){var s=this._getTpaPageId();"product_gallery"!==s&&"product_page"!==s||(a.unset(n,"data-src"),n.src=t)}return n},getSkinProperties:function(){var e=this._createOverlay(this.state.overlay),t=this._getIframeProperties(),i={"":{style:this.getCompRootStyle(this.props.style),"data-ignore-anchors":this.state.ignoreAnchors},overlay:this.state.showOverlay&&this.isNotWorker()?e:null,iframe:t||"remove"};return this.checkIfNeedToSendMemberData(),this.mutateSkinProperties&&(i=this.mutateSkinProperties(i)),i},_reload:function(){this._clearAliveTimeout(),clearTimeout(this.showOverlyIntervalId),this.showOverlyIntervalId=setTimeout(this._showOverlayIfNeeded,this.OVERLAY_GRACE),this._appAliveTimeout=setTimeout(this._onAppAliveTimeoutExpires,this.ALIVE_TIMEOUT);var e=this.getAppData();this.props.reportBI(l.RELOAD_TPA_CLICK,{appDefinitionId:a.get(e,"appDefinitionId"),appName:a.get(e,"appDefinitionName")}),this.registerReLayout(),this.setState(this.getInitialState())},checkIfNeedToSendMemberData:function(){var e=this.state.shouldGetSiteMemberDetails;if(e){var t=this.props.getMemberDetails();t&&e.callback({authResponse:!0,data:t})}},getInitialState:function(){var e=void 0;this.isNotWorker()||(e={widgetName:"worker"}),this.reportPerformanceBiEvent(l.APP_IFRAME_START_LOADING,e),this.urlState="",this._domNode=null,this._cachedBoundingClientRect=null;var t={visibility:"hidden",overlay:this.isUnderMobileView()&&this.isMobileReady&&!this.isMobileReady()?g.mobile:null,isAlive:!1,registeredEvents:[],showOverlay:!0,initialWidth:this.props.style.width,initialHeight:this.props.style.height,initialInstance:this.props.dynamicClientSpecMapAspect.getAppInstance(this.props.compData.applicationId)||this.getAppData(this).instance,initialRouterData:a.get(this.props.getExistingRootNavigationInfo(this.props.currentUrlPageId),"routerPublicData")},i=["14409595-f076-4753-8303-9a86f9f71469","14bcded7-0066-7c35-14d7-466cb3f09103"];return this.props.isExperimentOpen("sv_ssrLoadTpa")&&a.includes(i,this.getAppData().appDefinitionId)&&a.assign(t,{visibility:"visible",isAlive:!0}),this.shouldUpdateInitialRouterData=!0,this.mutateInitialState&&(t=this.mutateInitialState(t)),this.props.isExperimentOpen("sv_renderEcomSeoIframeSrc")&&(t.visibility="visible",t.isAlive=!0),t},_isCompInClientSpecMap:function(){return!!a.get(this.props.clientSpecMap,this.props.compData.applicationId)},_showOverlayIfNeeded:function(){this.state&&!1===this.state.isAlive&&!this.state.overlay&&this._isCompInClientSpecMap()&&this._isMounted&&this.setState({overlay:this._getInitialOverlay(),visibility:"visible"})},_shouldShowIframe:function(e){return(!a.get(this.props,"compProp.isHidden")||!this.props.isExperimentOpen("sv_hideCompInSafari"))&&(!e.overlay||"preloader"===e.overlay)},_getInitialOverlay:function(){return this.isMobileReady&&this.isUnderMobileView()&&!this.isMobileReady()?g.mobile:"preloader"},componentSpecificShouldUpdate:function(e){return!e.pageStub},componentWillReceiveProps:function(e){var t=a.get(this.props.getExistingRootNavigationInfo(e.currentUrlPageId),"routerPublicData");"masterPage"!==this.props.rootId||!this.shouldUpdateInitialRouterData||a.isUndefined(t)||a.isEqual(this.state.initialRouterData,t)||(this.setState({initialRouterData:t}),this.shouldUpdateInitialRouterData=!1);this.resize&&this.resize(e);var i=a.get(this.props.clientSpecMap,[this.props.compData.applicationId,"instance"]),n=a.get(e.clientSpecMap,[this.props.compData.applicationId,"instance"]);i!==n&&this.setState({initialInstance:n})},componentWillMount:function(){this.props.windowResizeEvent.registerToResize(this),this._domNode=null},componentDidMount:function(){this._isMounted=!0,this._domNode=n.findDOMNode(this),v(this.props)&&(this._cachedBoundingClientRect=this._domNode.getBoundingClientRect());var e=this.state.overlay;this.isNotWorker()&&(this.showOverlyIntervalId=setTimeout(this._showOverlayIfNeeded,this.OVERLAY_GRACE),this.props.isViewerMode||this.setOverlayState&&this.setOverlayState()),this.state.isAlive||a.includes(g,e)||!this.isNotWorker()||(this._appAliveTimeout=setTimeout(this._onAppAliveTimeoutExpires,this.ALIVE_TIMEOUT),d.incAppCounter())},componentWillUpdate:function(e,t){var i=t.height!==this.state.height||t.width!==this.state.width;v(e)&&i&&(this._cachedBoundingClientRect=null)},componentDidUpdate:function(){null===this._cachedBoundingClientRect&&v(this.props)&&(this._cachedBoundingClientRect=this._domNode.getBoundingClientRect())},isNotWorker:function(){return!this.isTPAWorker||!this.isTPAWorker()},_onAppAliveTimeoutExpires:function(){this.showUnresponsiveOverlay()},showUnresponsiveOverlay:function(){this._isMounted&&!this.state.isAlive&&this._isCompInClientSpecMap()&&this.setState({overlay:"unresponsive",visibility:"visible"},function(){this.reportBIAppNotResponsive()}.bind(this))},reportBIAppNotResponsive:function(){var e=this.props.compData.widgetId,t=this.getAppData(),i=e?a.get(t.widgets,e):c.getMainSectionWidgetData(t),n=this.props.biData,s={endpoint:a.get(i,"widgetUrl"),app_id:a.get(t,"appDefinitionId"),pageNo:n.getPageNumber(),totalLoadingTime:n.getTime().totalLoadingTime};this.props.reportBI(p.APP_IS_NOT_RESPONSIVE,s)},componentWillUnmount:function(){this._isMounted=!1,this._clearAliveTimeout(),clearTimeout(this.showOverlyIntervalId)},_clearAliveTimeout:function(){this._appAliveTimeout&&(window.clearTimeout(this._appAliveTimeout),this._appAliveTimeout=0,this.props&&d.decAppCounter(this.props.reportBeatEvent,this.props.primaryPageId))},setAppIsAlive:function(e){this.reportPerformanceBiEvent(l.APP_SDK_START_LOADING),this._clearAliveTimeout(),this.setState({isAlive:!0,overlay:"preloader"===this.state.overlay?null:this.state.overlay},function(){this.props.tpaComponentsDomAspect.markComponentIsAlive(this.props.id),e&&e()})},_isUrlSecure:function(e){return/^https/.test(e)},reportPerformanceBiEvent:function(e,t){var i=this.getAppData(),n=a.get(this.props,"compData.widgetId");if(!n){var s=c.getMainSectionWidgetData(i);n=a.get(s,"widgetId")}var o=this.props.biData,r=o.getTime(),p={compId:this.props.id,pageId:o.getPageId(),pageNo:o.getPageNumber(),loadingTime:r.loadingTime,totalLoadingTime:r.totalLoadingTime};a.get(i,"isWixTPA")?(p.widgetId=n,p.appDefinitionId=a.get(i,"appDefinitionId")):(p.externalWidgetId=n,p.externalAppDefinitionId=a.get(i,"appDefinitionId")),a.merge(p,t),this.props.reportBI(e,p)},enterFullScreen:function(e){I(this.props)&&this.setState({isMobileFullScreenMode:!0},e)},exitFullScreen:function(e){this.setState({isMobileFullScreenMode:!1},e)}}}),define("tpa/common/TPABaseUrlBuilder",["lodash","utils"],function(e,t){"use strict";var i=function(e){this.url=t.urlUtils.parseUrl(e),this.url.query=this.url.query||{},this.url.search=null,this.url.hash=this.url.hash||""};return i.prototype={addQueryParam:function(t,i){var a=this.url.query;return i&&!e.isEmpty(i)&&(a[t]?e.isArray(a[t])?a[t].push(i):a[t]=[a[t],i]:a[t]=i),this},addMultipleQueryParams:function(t){return t&&!e.isEmpty(t)&&e.assign(this.url.query,t),this},addQueryParamsFromFunc:function(t,i){return e.isFunction(t)&&t.apply(null,[this].concat(i)),this},setHash:function(t){return e.isString(t)&&!e.isEmpty(t)&&(t="#"===t[0]?t:"#"+t,this.url.hash=t),this},mutateIframeSrc:function(e){return e&&(this.url=e(this.url)),this},filterQueryParams:function(t){return t&&!e.isEmpty(t)&&(this.url.query=e.pick(this.url.query,t)),this},build:function(){return t.urlUtils.buildFullUrl(this.url)}},i}),define("tpa/common/TPAUrlBuilder",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(e,t,i){"use strict";var a=function(e){i.call(this,e)};return a.prototype=e.assign(new i,{addCacheKiller:function(e){return this.addQueryParam("cacheKiller",e)},addInstance:function(e){return this.addQueryParam("instance",e)},addWidth:function(e){return this.addQueryParam("width",e)},addLocale:function(e){return this.addQueryParam("locale",e)},addFullLocale:function(e){return this.addQueryParam("fullLocale",e)},addViewMode:function(e){return this.addQueryParam("viewMode",e)},addCompId:function(e){return this.addQueryParam("compId",e)},addDeviceType:function(e){return this.addQueryParam("deviceType",e)},addEndpointType:function(e){return this.addQueryParam("endpointType",e)},addOrigCompId:function(e){return this.addQueryParam("origCompId",e)},addExternalId:function(e){return this.addQueryParam("externalId",e)},addOrigin:function(e){return this.addQueryParam("origin",e)},addPageId:function(e){return this.addQueryParam("pageId",e)},addHeight:function(e){return this.addQueryParam("height",e)},addViewerSessionId:function(e){return this.addQueryParam("vsi",e)},addCbi:function(e){return this.addQueryParam("cbi",e)},addRouterData:function(e,t){try{var i=void 0;return e&&(i=t("sv_tpaDecodeRouterData")?btoa(JSON.stringify(e)):JSON.stringify(e)).length<400?this.addQueryParam("routerData",i):this}catch(e){return this}}}),a}),define("tpa/utils/sitePages",["lodash","utils","coreUtils","tpa/utils/tpaUtils"],function(e,t,i,a){"use strict";var n=function(i,a){a=a||{};var n=t.menuUtils.getSiteMenuWithoutRenderedLinks(i,!0);a.filterHideFromMenuPages&&(n=s(n,i.getClientSpecMap())),a.homePageId=i.getMainPageId();var o=l(n,i,a);return a.includeIsHomePage&&(o=c(o,a.homePageId)),a.includePagesUrl&&(o=r(i,o,e.get(a,"baseUrl"),a)),o},s=function(t,i){return e.filter(t,function(e){return!p(i,e.link)})};function o(e,i,a,n){return t.wixUrlParser.getUrl(e,{pageId:i,title:a},void 0,!0,n)}var r=function t(i,a,n){return e.map(a,function(e){var a=i.getDataByQuery(e.id,"masterPage");return a&&a.pageUriSEO&&(e.url=o(i,e.id,a.pageUriSEO,n)),e.subPages&&(e.subPages=t(i,e.subPages,n)),e})},p=function(t,i){if("PageLink"===e.get(i,"type")){var n=e.get(i,"pageId.tpaApplicationId"),s=e.get(i,"pageId.tpaPageId"),o=e.get(t,n);return a.isPageMarkedAsHideFromMenu(o,s)}return!1},c=function t(i,a){return e.map(i,function(e){return e.isHomepage=d(e,a),e.subPages&&(e.subPages=t(e.subPages,a)),e})},d=function(t,i){return!e.isUndefined(t)&&t.id===i},l=function(t,i,a){var n=[],s=a.enhancedInfo?m:u;return e.forEach(t,function(t){var o=s(t,i,a),r=t.items;e.forEach(r,function(e){var t=s(e,i,a);o.subPages=o.subPages||[],o.subPages.push(t)}),n.push(o)}),n},u=function(i){if(i.link){var a=e.get(i.link,"pageId.id");return{title:i.label||"",id:t.stringUtils.startsWith(a,"#")?a.substr(1):a,hide:!i.isVisible||!1}}return{}},g=function(i,a,n){var s=function(i){var a=e.get(i,"link.pageId.id");return a?t.stringUtils.startsWith(a,"#")?a.substr(1):a:""}(i),r=e.get(i,"link.pageId.pageUriSEO"),p={isHomePage:s===n.homePageId};return r&&(p.url=o(a,s,r,n.baseUrl)),p},m=function(t,a,n){var s=i.linkUtils.getRelevantLinkDataFromMenuItem(t);switch((s=e.merge(s,{type:s.type||"MenuHeader",title:t.label||"",hidden:!t.isVisible||!1})).type){case"PageLink":case"AnchorLink":s=e.merge(s,g(t,a,n));break;case"DocumentLink":s.url=i.linkUtils.getDocumentLink(t.link,a)}return s},h=function(e,t){return t.getDataByQuery(e,"masterPage")},f=function(t,i){var a=[];return e.forEach(t,function(t){e.forEach(t.subPages,function(e){a.push(h(e.id,i))}),a.push(h(t.id,i))}),a};return{getSitePagesInfoData:n,getSitePagesData:function(e){var t=n(e);return f(t,e)}}}),define("tpa/services/pageService",["lodash","tpa/utils/sitePages","utils"],function(e,t,i){"use strict";var a=new i.SiteDataPrivates;return{mapPageToWidgets:function(i){var n=i.getSiteData();a.has(n)||a.set(n,{});var s=a.get(n);if(e.size(s)>0)return s;var o=t.getSitePagesData(i.getSiteData());return e.forEach(o,function(t){if(t&&t.tpaApplicationId>0){var i={pageId:t.id,tpaId:t.tpaApplicationId,tpaPageId:t.tpaPageId};e.isUndefined(s[i.tpaId])&&(s[i.tpaId]=[]),s[i.tpaId].push(i)}}),s}}}),define("tpa/mixins/tpaUrlBuilderMixin",["lodash","utils","santaProps","tpa/utils/tpaUtils","tpa/common/TPAUrlBuilder","tpa/services/pageService"],function(e,t,i,a,n,s){"use strict";return{propTypes:{id:i.Types.Component.id.isRequired,isViewerMode:i.Types.isViewerMode,componentViewMode:i.Types.RenderFlags.componentViewMode,languageCode:i.Types.RendererModel.languageCode,compData:i.Types.Component.compData.isRequired,getCurrentUrl:i.Types.getCurrentUrl.isRequired,rootId:i.Types.Component.rootId,viewerSessionId:i.Types.viewerSessionId,currentUrl:i.Types.currentUrl.isRequired,aspectData:i.Types.TPA.data,locale:i.Types.RendererModel.locale,isExperimentOpen:i.Types.isExperimentOpen},getInitialState:function(){this.viewMode=this.getViewMode()},getViewMode:function(){return this.props.isViewerMode?"site":this.props.componentViewMode},buildUrl:function(i,o){var r=e.get(this.props,"aspectData.queryParams",{});r=e.merge(r,(p=this,c=r,p.mutateIframeUrlQueryParam&&(c=p.mutateIframeUrlQueryParam(c)),c));var p,c;r=e.merge(r,a.getDebuggingParamsFromUrl(this.props.currentUrl)),r=e.merge(r,this.state.sectionUrlParams),this.getEcomParams&&this.getEcomParams()&&(r["ecom-tpa-params"]=this.getEcomParams());var d=this.props.getCurrentUrl()&&t.urlUtils.parseUrl(this.props.getCurrentUrl());i=a.appendProtocolToUrlIfNeeded(i,d);var l=this.getAppData(this),u=this.props.id;i=function(t,i,n){var s=t;if(e.includes(t,"{instanceId}")){var o=i.instanceId;o||(o=a.getInstanceFromAppData(i).instanceId),s=e.replace(s,new RegExp("{instanceId}","g"),o)}return e.includes(t,"{compId}")&&(s=e.replace(s,new RegExp("{compId}","g"),n)),s}(i,l,u);var g=this.state.initialHeight?this.state.initialHeight.toString():void 0,m=new n(i).addCompId(u).addDeviceType(this.getDeviceType(this)).addInstance(this.state.initialInstance).addLocale(this.props.languageCode).addViewMode(this.viewMode).addCacheKiller(a.getCacheKiller()).addExternalId(this.props.compData.referenceId).addPageId(this.props.rootId).addHeight(g).filterQueryParams(o).addMultipleQueryParams(r).addViewerSessionId(this.props.viewerSessionId).addRouterData(this.state.initialRouterData,this.props.isExperimentOpen);if(this.props.isExperimentOpen("sv_tpaAddFullLocale")&&m.addFullLocale(this.props.locale),this.props.isExperimentOpen("sv_renderEcomSeoIframeSrc")&&this.props.tpaComponentsDomAspect){var h=this.props.tpaComponentsDomAspect.aspectSiteApi.getSiteAPI(),f=s.mapPageToWidgets(h),v=this.props.compData.applicationId;if(!e.isEmpty(f)&&f[v]){var I=f[v],y=e.find(I,{tpaPageId:"product_page"});if(y){var S=y.pageId,P=h.getPageUrlFor(S);m.addQueryParam("productPageUrl",P),m.addQueryParam("standalone","true")}}}return this.mutateIframeSrc&&m.mutateIframeSrc(this.mutateIframeSrc),m.build()}}}),define("tpa/common/supportedSiteEvents",[],function(){"use strict";return{SCROLL:"SCROLL",PAGE_NAVIGATION:"PAGE_NAVIGATION",PAGE_NAVIGATION_IN:"PAGE_NAVIGATION_IN",PAGE_NAVIGATION_OUT:"PAGE_NAVIGATION_OUT",PAGE_NAVIGATION_CHANGE:"PAGE_NAVIGATION_CHANGE",STATE_CHANGED:"STATE_CHANGED",SESSION_CHANGED:"SESSION_CHANGED",INSTANCE_CHANGED:"INSTANCE_CHANGED",MEMBER_DETAILS_UPDATED:"MEMBER_DETAILS_UPDATED",SITE_METADATA_CHANGED:"SITE_METADATA_CHANGED",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP"}}),define("tpa/mixins/tpaCompApiMixin",["lodash","reactDOM","santaProps","tpa/common/supportedSiteEvents"],function(e,t,i,a){"use strict";return{propTypes:{id:i.Types.Component.id.isRequired,clientSpecMap:i.Types.RendererModel.clientSpecMap.isRequired,compData:i.Types.Component.compData.isRequired,isMobileView:i.Types.isMobileView,sendPostMessage:i.Types.TPA.sendPostMessage.isRequired,windowScrollEvent:i.Types.SiteAspects.windowScrollEvent.isRequired,windowKeyboardEvent:i.Types.SiteAspects.windowKeyboardEvent.isRequired,svSessionChangeEvent:i.Types.SiteAspects.svSessionChangeEvent.isRequired,deleteCompListeners:i.Types.TPA.deleteCompListeners.isRequired,siteMetadataChangeAspect:i.Types.SiteAspects.siteMetadataChangeAspect.isRequired,tpaPageNavigationAspect:i.Types.SiteAspects.tpaPageNavigationAspect.isRequired,dynamicClientSpecMapAspect:i.Types.SiteAspects.dynamicClientSpecMapAspect.isRequired,registerToMemberDetailsChange:i.Types.SiteMembersSantaTypes.registerToMemberDetailsChange.isRequired,unRegisterMemberDetailsChange:i.Types.SiteMembersSantaTypes.unRegisterMemberDetailsChange.isRequired},isEventSupported:function(e){return!!a[e]},isCompListensTo:function(t){return e.includes(this.state.registeredEvents,t)},getAppData:function(){return this.props.clientSpecMap[this.props.compData.applicationId]||{}},getDeviceType:function(){return this.props.isMobileView?"mobile":"desktop"},sendPostMessage:function(e){this.props.sendPostMessage(this,e)},getIframe:function(){return this.refs.iframe&&t.findDOMNode(this.refs.iframe)},startListen:function(e){if(this.isEventSupported(e)&&(this.setState({registeredEvents:this.state.registeredEvents.concat(e)}),this.props))switch(e){case a.PAGE_NAVIGATION:case a.PAGE_NAVIGATION_IN:case a.PAGE_NAVIGATION_OUT:case a.PAGE_NAVIGATION_CHANGE:this.props.tpaPageNavigationAspect.registerToPageChanged(this,e);break;case a.SCROLL:this.props.windowScrollEvent.registerToScroll(this);break;case a.SESSION_CHANGED:this.props.svSessionChangeEvent.registerToSessionChanged(this);break;case a.INSTANCE_CHANGED:this.props.dynamicClientSpecMapAspect.registerToInstanceChanged(this);break;case a.MEMBER_DETAILS_UPDATED:this.props.registerToMemberDetailsChange(this);break;case a.SITE_METADATA_CHANGED:this.props.siteMetadataChangeAspect.registerToSiteMetadataChange(this);break;case a.KEY_DOWN:this.props.windowKeyboardEvent.registerToKeyDown(this);break;case a.KEY_UP:this.props.windowKeyboardEvent.registerToKeyUp(this)}},stopListen:function(t){if(this.setState({registeredEvents:e.without(this.state.registeredEvents,t)}),this.props)switch(t){case a.PAGE_NAVIGATION:case a.PAGE_NAVIGATION_IN:case a.PAGE_NAVIGATION_OUT:case a.PAGE_NAVIGATION_CHANGE:this.props.tpaPageNavigationAspect.unregisterToPageChanged(this);break;case a.SCROLL:this.props.windowScrollEvent.unregisterToScroll(this,t);break;case a.SESSION_CHANGED:this.props.svSessionChangeEvent.unRegisterToSessionChanged(this);break;case a.INSTANCE_CHANGED:this.props.dynamicClientSpecMapAspect.unRegisterToInstanceChanged(this);break;case a.MEMBER_DETAILS_UPDATED:this.props.unRegisterMemberDetailsChange(this);break;case a.SITE_METADATA_CHANGED:this.props.siteMetadataChangeAspect.unRegisterToSiteMetadataChange(this);break;case a.KEY_DOWN:this.props.windowKeyboardEvent.unRegisterKeyDown(this);break;case a.KEY_UP:this.props.windowKeyboardEvent.unRegisterKeyUp(this)}},setSiteMemberDataState:function(e){this.setState({shouldGetSiteMemberDetails:e})},hasOrigComponent:function(){return!e.isUndefined(this.props.compData.origCompId)},componentWillUnmount:function(){var t=this.props.id,i=this.getAppData().appDefinitionId;this.props.deleteCompListeners(i,t),e.forEach(e.get(this.state,"registeredEvents",[]),function(e){this.stopListen(e)}.bind(this))}}}),define("tpa/mixins/tpaWidgetMixin",["santaProps"],function(e){"use strict";return{propTypes:{compData:e.Types.Component.compData.isRequired},getBaseUrl:function(){var e=this.getAppData();if(e.widgets){var t=this.props.compData.widgetId,i=e.widgets[t];if(i){var a=this.isInMobileDevMode&&this.isInMobileDevMode();if(this.isUnderMobileView()){return i.mobileUrl&&(a||i.mobilePublished)?i.mobileUrl:i.widgetUrl}return i.widgetUrl}}return""}}}),define("tpa/mixins/tpaResizeWindowMixin",["lodash"],function(e){"use strict";var t=/^[0-9]+%$/;function i(i){return e.isNumber(i)&&i>=0||(a=i,t.test(a));var a}return{resizeWindow:function(e,t,a){var n=!1,s={};i(t)&&t!==this.state.height&&(s.height=t,n=!0),i(e)&&e!==this.state.width&&(s.width=e,n=!0),n&&(this.registerReLayout(),this.setState(s,a))}}}),define("tpa/components/tpaWidget",["lodash","core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(e,t,i,a,n,s,o,r){"use strict";var p=t.compRegistrar,c=t.compMixins,d={displayName:"TPAWidget",propTypes:{structure:i.Types.Component.structure.isRequired},statics:{useSantaTypes:!0},mixins:[c.skinBasedComp,c.timeoutsMixin,a,n,s,o,r],mutateIframeUrlQueryParam:function(t){t.width=this.state.initialWidth;var i=this.props.structure.originCompId;return i&&!e.isEmpty(i)&&(t.originCompId=i),t}};return p.register("wysiwyg.viewer.components.tpapps.TPAWidget",d,!0),d}),define("tpa/mixins/tpaSectionMixin",["lodash","santaProps","tpa/common/supportedSiteEvents"],function(e,t,i){"use strict";return{propTypes:{isExperimentOpen:t.Types.isExperimentOpen,getExistingRootNavigationInfo:t.Types.getExistingRootNavigationInfo,rootId:t.Types.Component.rootId.isRequired,pageUrlWithHash:t.Types.pageUrlWithHash.isRequired,pageId:t.Types.Component.pageId,compData:t.Types.Component.compData.isRequired,isViewerMode:t.Types.isViewerMode,currentUrlPageId:t.Types.Component.currentUrlPageId,dynamicClientSpecMapAspect:t.Types.SiteAspects.dynamicClientSpecMapAspect.isRequired},isTPASection:!0,getSiteUrlStateFromProps:function(e){var t=e.getExistingRootNavigationInfo(e.rootId);return t&&t.tpaInnerRoute||""},getSiteUrlQueryParamsFromProps:function(t){var i=t.getExistingRootNavigationInfo(t.rootId),a=e.get(i,"queryParams.appSectionParams"),n={};if(a)try{n=JSON.parse(a)}catch(e){}return n},mutateSkinProperties:function(e){return"object"===_typeof(e.iframe)&&(this.props.isExperimentOpen("sv_renderEcomSeoIframeSrc")&&e.iframe.src?e.iframe.src=this.buildUrl(this.getBaseUrl()):e.iframe["data-src"]=this.buildUrl(this.getBaseUrl())),e},mutateInitialState:function(e){return e.sectionUrlState=this.getSiteUrlStateFromProps(this.props),e.sectionUrlParams=this.getSiteUrlQueryParamsFromProps(this.props),e.sectionUrl=this.fixSectionUrl(),e},fixSectionUrl:function(){var e=this.props.pageUrlWithHash;return this.endsWith(e,"/")?e:e+"/"},endsWith:function(t,i){return e.endsWith(t,i)},isViewerMode:function(){return"site"===this.getViewMode()},componentWillReceiveProps:function(t){var i=this.getSiteUrlStateFromProps(t),a=this.getSiteUrlQueryParamsFromProps(t);e.isUndefined(this.state.pushState)?t.currentUrlPageId===this.props.pageId&&this.isViewerMode()&&(this.urlState!==i||this.shouldUpdateState)&&(this.urlState=i,this.shouldUpdateState=!1,this.setState({sectionUrlState:i}),this.props.isExperimentOpen("sv_tpaStateChangedEvent")&&this.reportStateChanged(this.urlState)):(this.urlState=this.state.pushState,this.setState({pushState:void 0}),this.props.isExperimentOpen("sv_tpaStateChangedEvent")&&this.reportStateChanged(this.urlState)),t.currentUrlPageId===this.props.pageId&&this.state.sectionUrlParams!==a&&this.setState({sectionUrlParams:a}),this.props.isExperimentOpen("sv_tpaStateChangedEvent")||this.reportStateChanged(i)},componentDidMount:function(){this.shouldUpdateState=!1,this.props.dynamicClientSpecMapAspect.registerReloadSpecMapPlugin(this.props.pageId,function(){this.shouldUpdateState=!0}.bind(this))},reportStateChanged:function(e){this.isCompListensTo(i.STATE_CHANGED)&&this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:e}})},isMobileReady:function(){var t=this.getAppData(),i=this.isInMobileDevMode&&this.isInMobileDevMode(),a=this.props.compData,n=e.get(t,"widgets");if(n&&a.widgetId){var s=n[a.widgetId];return s.mobileUrl&&(i||s.mobilePublished)}return t.sectionMobileUrl&&(i||t.sectionMobilePublished)},mutateIframeUrlQueryParam:function(e){return this.props.isViewerMode?(e["section-url"]=this.fixSectionUrl(),e.target="_top"):(e["section-url"]=this.getBaseUrl(),e.target="_self"),e.width=this.state.initialWidth,e},mutateIframeSrc:function(e){return e=this.addStateToUrlObj(e,this.state.sectionUrlState)},addStateToUrlObj:function(e,t){if(t){"#"===t.charAt(0)?e.hash=t:(e.path&&"/"!==e.path.slice(-1)&&(e.path+="/"),e.path+=t)}return e}}}),define("tpa/components/tpaSection",["lodash","core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(e,t,i,a,n,s,o,r){"use strict";var p=t.compRegistrar,c=t.compMixins,d={displayName:"TPASection",propTypes:{compData:i.Types.Component.compData.isRequired},statics:{useSantaTypes:!0},mixins:[c.skinBasedComp,c.timeoutsMixin,a,n,s,o,r],getBaseUrl:function(){var t=this.getAppData(),i=this.props.compData.widgetId,a=t.sectionUrl,n=t.sectionDefaultPage,s=this.props.compData.type,o=this.isUnderMobileView()&&this.isMobileReady();if("TPAWidget"===s&&i){var r=e.find(t.widgets,{widgetId:i});r&&(n=r.appPage.defaultPage,a=o?r.mobileUrl:r.widgetUrl)}else o&&(a=t.sectionMobileUrl);return n&&!e.isEmpty(n)&&("/"!==a.slice(-1)&&(a+="/"),a+=n),a}};return p.register("wysiwyg.viewer.components.tpapps.TPASection",d,!0),d}),define("tpa/components/tpaMultiSection",["lodash","core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(e,t,i,a,n,s,o,r){"use strict";var p=t.compRegistrar,c=t.compMixins,d={displayName:"TPAMultiSection",propTypes:{compData:i.Types.Component.compData.isRequired},statics:{useSantaTypes:!0},mixins:[c.skinBasedComp,c.timeoutsMixin,a,n,s,o,r],getBaseUrl:function(){var t=this.getAppData(),i=t.sectionUrl,a=t.widgets[this.props.compData.widgetId],n=t.sectionDefaultPage;return a&&(i=this.isUnderMobileView()&&this.isMobileReady()?a.mobileUrl:a.widgetUrl,n=a.appPage.defaultPage),n&&!e.isEmpty(n)&&("/"!==i.slice(-1)&&(i+="/"),i+=n),i}};return p.register("wysiwyg.viewer.components.tpapps.TPAMultiSection",d,!0),d}),define("tpa/components/tpaWorker",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin"],function(e,t,i,a){"use strict";var n=e.compRegistrar,s={displayName:"TPAWorker",mixins:[e.compMixins.skinBasedComp,t,i,a],statics:{useSantaTypes:!0},getBaseUrl:function(){return this.getAppData().appWorkerUrl},mutateIframeUrlQueryParam:function(e){return e.endpointType="worker",e},mutateSkinProperties:function(e){return e.iframe&&e.iframe.style&&(e.iframe.style.display="none"),e},isTPAWorker:function(){return!0}};n.register("tpa.viewer.classes.TPAWorker",s)}),define("tpa/components/tpaGluedWidget",["core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(e,t,i,a,n,s,o){"use strict";var r=e.compRegistrar,p=e.compMixins,c={displayName:"TPAGluedWidget",statics:{useSantaTypes:!0,behaviors:{notifyWidget:{methodName:"notifyWidgetInternal",params:["action"]}}},mixins:[p.skinBasedComp,p.timeoutsMixin,i,a,n,s,o],mutateIframeUrlQueryParam:function(e){return e.width=this.state.initialWidth,e},mutateSkinProperties:function(e){return e[""]["data-has-ads"]=this.props.shouldShowWixAds,e},notifyWidgetInternal:function(e){this.sendPostMessage({intent:"addEventListener",eventType:"QUICK_ACTION_TRIGGERED",params:{quickAction:e}})}};return r.register("wysiwyg.viewer.components.tpapps.TPAGluedWidget",c,!0),c}),define("tpa/layout/gluedWidgetPatcher",["lodash","tpa/common/tpaMetaData"],function(e,t){"use strict";var i="fixed";function a(t,i){var a=t,n=i.height.screen,s=i.width.screen,o=i.custom.WIX_ADStop;if(o){a=function(t,i,a){s=i,(n=a).right<s.left||n.left>s.right||n.bottom<s.top||n.top>s.bottom||!e.isNumber(t.top)||(t.top=(t.top||0)+(a.bottom-i.top));var n,s;return t}(a,(r=a,p=s,c=n,{top:e.isNumber(r.top)?e.parseInt(r.top):c-r.height,bottom:e.isNumber(r.bottom)?c-e.parseInt(r.bottom):e.parseInt(r.top)+r.height,right:e.isNumber(r.right)?p-e.parseInt(r.right):e.parseInt(r.left)+r.width,left:e.isNumber(r.left)?e.parseInt(r.left):p-r.width}),o)}var r,p,c;return a}function n(n,s,o,r,p){if(p.isMobileView())(function(i,a){var n=i.dataItem,s=a[n.applicationId],o=t.PERMITTED_FULL_SCREEN_TPAS_IN_MOBILE;return s&&e.includes(o,s.appDefinitionId)})(r,p.getClientSpecMap())&&s.css(n,{position:"fixed",margin:"0",top:"0",left:"auto",width:o.width.screen,height:"100%",zIndex:2e3});else{var c=function(t,a,n){var s={};return e.forEach(n,function(n){var o=a[n]&&a[n][t],r=n;e.isUndefined(o)||(0===n.indexOf(i)&&(r=r.slice(i.length).toLowerCase()),s[r]=o)}),s}(n,o,["position","fixedTop","fixedLeft","right","bottom","width","height"]);c=a(c,o),c=e.omit(c,["width","height"]),s.css(n,c)}}return function(){this.patchGluedWidget=n}}),define("tpa/layout/tpaMeasurer",["zepto","lodash"],function(e,t){"use strict";return{measureTPA:function(i,a,n,s,o){var r=e(n[i]);t.set(a.custom,[i,"hasIframe"],Boolean(n[i+"iframe"]));var p=parseInt(r.css("min-height"),10),c=parseInt(r.css("min-width"),10),d=r.attr("data-ignore-anchors");p&&"true"!==d&&(a.minHeight[i]=p,a.height[i]=p),p&&"true"===d&&(a.minHeight[i]=o.structure.layout.height,a.height[i]=o.structure.layout.height),c&&(a.minWidth[i]=c,a.width[i]=c)}}}),define("tpa/layout/tpaGluedWidgetPlacement",[],function(){"use strict";return{getDefaultPlacement:function(e,t){var i=e.applicationId,a=e.widgetId,n=t[i];if(n){var s=n.widgets[a];if(s)return(s.gluedOptions||{horizontalMargin:0,placement:"BOTTOM_RIGHT",verticalMargin:0}).placement}}}}),define("tpa/utils/gluedWidgetMeasuringUtils",["lodash","tpa/layout/tpaGluedWidgetPlacement"],function(e,t){"use strict";var i=300,a=120;function n(e){return"number"==typeof e?e:e?parseFloat(e)||0:0}function s(e){return(e>2||e<-2)&&(e=0),e}return{getGluedWidgetMeasurements:function(o,r,p,c,d,l){var u=s(r.props.horizontalMargin),g=s(r.props.verticalMargin),m=r.props.placement||t.getDefaultPlacement(r.data,o),h=function(t,s,o,r,p,c,d,l){c=n(c),d=n(d);var u={},g=void 0;function m(){if(c>=-1&&c<=1){var e=r/2-s/2,t=c*((r-2*a)/2-s/2);u.top=e+t}else if(c<-1&&c>=-2)g=2+c,u.top=g*a;else if(c>1&&c<=2){g=2-c;var i=Math.floor(g*a);u.top=r-i-s}}function h(){if(d>=-1&&d<=1){var e=o/2-t/2,a=d*((o-2*i)/2-t/2);u.left=e+a}else if(d>1&&d<=2){g=2-d;var n=Math.floor(g*i);u.left=o-n-t}else d<-1&&d>=-2&&(g=2+d,u.left=g*i)}switch(p){case"TOP_LEFT":u.top=0,u.left=0,u.bottom="auto";break;case"TOP_RIGHT":u.top=0,u.right=0,u.bottom="auto";break;case"TOP_CENTER":u.top=0,u.bottom="auto",h();break;case"CENTER_RIGHT":u.right=0,m();break;case"CENTER_LEFT":u.left=0,m();break;case"BOTTOM_LEFT":u.bottom=0,u.left=0,u.top="auto";break;case"BOTTOM_CENTER":u.bottom=0,u.top="auto",h();break;case"BOTTOM_RIGHT":default:u.bottom=0,u.right=0,u.top="auto"}return e.defaults(u,{position:l?"absolute":"fixed",top:"0",left:"0"})}(r.layout.width,r.layout.height,p,c,m,g,u,l),f=function(t,i){var a={};return i&&i>0&&e.isNumber(t.bottom)&&t.bottom<i&&(a.bottom=i),a}(h,d||0),v=e.assign(h,f);return 0===v.right&&(v.left=p-r.layout.width),0===v.bottom&&(v.top=c-r.layout.height-(d||0)),v}}}),define("tpa/layout/gluedWidgetMeasurer",["lodash","zepto","tpa/layout/tpaMeasurer","tpa/utils/gluedWidgetMeasuringUtils"],function(e,t,i,a){"use strict";return function(n){this.measureGluedWidget=function(n,s,o,r,p,c){var d=c.propertiesItem,l=c.dataItem,u=e.assign(c.layout,{height:t(r[s]).height(),width:t(r[s]).width()}),g=o.width.screen,m=o.height.screen;d.placement=d.placement||n(l,p);var h={props:d,data:l,layout:u},f=p.getClientSpecMap(),v=p.isMobileView(),I=a.getGluedWidgetMeasurements(f,h,g,m,o.siteMarginBottom,v);0===(y=I).right&&(y.left="auto"),0===y.bottom&&(y.top="auto"),0===y.left&&(y.right="auto"),0===y.top&&(y.bottom="auto");var y;(I=y).fixedTop=I.top,I.fixedLeft=I.left,delete I.top,delete I.left,e.forEach(I,function(e,t){o[t]=o[t]||{},o[t][s]=e}),e.set(o.custom,[s,"has-ads"],Boolean(t(r[s]).data("has-ads"))),o.width[s]=u.width,i.measureTPA(s,o,r)}.bind(this,function(e,t){try{return n.getDefaultPlacement(e,t)}catch(e){return""}})}}),define("tpa/layout/tpaSectionPatcher",["lodash","zepto","tpa/services/clientSpecMapService","experiment"],function(e,t,i,a){"use strict";return{patchTPASection:function(e,t,n,s,o){var r=n.height[e],p=s.dataItem,c=o.getClientSpecMap()[p.applicationId];if(c&&i.isFullPage(p,c)){var d={};d.position="fixed",d.left="0px",d.top="0px",d.right="0px",d.bottom="0px",o.isMobileView()&&(r=n.height.screen-n.siteOffsetTop,d=function(e,t,i){var a=t.height.screen-t.siteOffsetTop;return e.height=a+"px",e.minHeight=a+"px",e.top=t.siteOffsetTop+"px",i.isViewerMode()||(e.left=void 0,e.right=void 0),e}(d,n,o)),t.css(e,d)}var l=n.width[e],u=o.os.ios&&o.browser.safari;n.custom[e].hasIframe&&(a.isOpen("sv_tpaMobileViewportFix",o)&&i.isCurrentPageFullResponsive(o)?t.css(e+"iframe",{position:"fixed",height:"calc(100% - "+n.siteOffsetTop+"px)",left:0}):u&&t.css(e+"iframe",{width:l,height:r}))}}}),define("tpa/layout/mobileSafariPatcher",[],function(){"use strict";return{patchWidth:function(e,t,i,a,n){n.os.ios&&n.browser.safari&&i.custom[e].hasIframe&&t.css(e+"iframe",{width:1,minWidth:"100%"})}}}),define("tpa/layout/tpaLayout",["layout","tpa/layout/gluedWidgetPatcher","tpa/layout/gluedWidgetMeasurer","tpa/layout/tpaSectionPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaGluedWidgetPlacement","tpa/layout/mobileSafariPatcher"],function(e,t,i,a,n,s,o){"use strict";var r=new t(s),p=new i(s);return e.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAWidget",n.measureTPA),e.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPASection",n.measureTPA),e.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAMultiSection",n.measureTPA),e.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAGluedWidget",p.measureGluedWidget),e.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAWidget"),e.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAGluedWidget"),e.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPASection"),e.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAMultiSection"),e.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPASection",[["iframe"]]),e.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAMultiSection",[["iframe"]]),e.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAWidget",[["iframe"]]),e.registerPatcher("wysiwyg.viewer.components.tpapps.TPAGluedWidget",r.patchGluedWidget),e.registerPatcher("wysiwyg.viewer.components.tpapps.TPAMultiSection",a.patchTPASection),e.registerPatcher("wysiwyg.viewer.components.tpapps.TPASection",a.patchTPASection),e.registerPatcher("wysiwyg.viewer.components.tpapps.TPAWidget",o.patchWidth),["wysiwyg.viewer.components.WixAdsMobile","wysiwyg.viewer.components.WixAdsDesktop"].forEach(function(t){e.registerRequestToMeasureChildren(t,[["desktopWADTop"],["desktopWADBottom"],["mobileWADTop"]]),e.registerCustomMeasure(t,p.measureWixAdComponent)}),{}}),define("tpa/components/tpaPreloaderOverlay",["core"],function(e){"use strict";var t=e.compRegistrar,i={mixins:[e.compMixins.skinBasedComp],statics:{useSantaTypes:!0},getSkinProperties:function(){return{preloader:{className:"circle-preloader"}}}};t.register("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",i)}),define("tpa/services/tpaPreviewEditorCommunicationService",["core"],function(e){"use strict";var t=[],i=1;e.siteAspectsRegistry.registerSiteAspect("tpaPreviewEditorAspect",function(e){"undefined"!=typeof window&&e.registerToMessage(n)});var a=function(e,a,n,s){var o={intent:"TPA_PREVIEW",callId:i++,type:e,compId:n,data:a};return s&&(t[o.callId]=s),o},n=function(e){if(e&&e.data){var i={};try{i=JSON.parse(e.data)}catch(e){return}switch(i.intent){case"TPA_PREVIEW":i.callId&&t[i.callId]&&(t[i.callId](i.res),delete t[i.callId])}}};return{doPostMessage:function(e,t,i,n){var s=a(e,t,i,n),o=void 0;window.parent.postMessage?o=window.parent:window.parent.document.postMessage&&(o=window.parent.document),o&&void 0!==o&&o.postMessage(JSON.stringify(s),"*")}}}),define("tpa/mixins/tpaPreviewEditorMixin",["tpa/services/tpaPreviewEditorCommunicationService"],function(e){"use strict";return{openHelp:function(t){e.doPostMessage("openHelp",t)}}}),define("tpa/components/tpaUnavailableMessageOverlay",["react","santaProps","core","tpa/mixins/tpaPreviewEditorMixin"],function(e,t,i,a){"use strict";var n=i.compRegistrar,s=i.compMixins,o=Object.freeze({displayName:"TPAUnavailableMessageOverlay",mixins:[s.skinBasedComp,a],propTypes:{compData:t.Types.Component.compData.isRequired},statics:{useSantaTypes:!0},getInitialState:function(){return{showOverlay:!0}},getSkinProperties:function(){return{text:{children:[this.props.compData.text]},dismissButton:{onClick:this.props.compData.hideOverlayFunc},reloadButton:{children:[this.props.compData.reload],onClick:this.props.compData.reloadFunc},openHelp:this.openHelp}}});n.register("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",o)}),define("tpa/common/tpaPostMessageCommon",["lodash"],function(e){"use strict";var t={TPA_MESSAGE:"TPA",TPA_MESSAGE_PREVIEW:"TPA_PREVIEW",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",TPA_PREVIEW_RESPONSE:"TPA_PREVIEW_RESPONSE",PINGPONG_PREFIX:"pingpong:"},i=function(e,t,i){var a="";try{a=JSON.stringify(t)}catch(e){return}e.postMessage||(e=e.contentWindow),e.postMessage(a,i||"*")},a=function(e,a,n){return function(s){try{i(e,{intent:n||t.TPA_RESPONSE,callId:a.callId,type:a.type,res:s,status:!0})}catch(e){}}},n=function(e){return e===t.TPA_MESSAGE||e===t.TPA_MESSAGE2};return{Intents:t,callPostMessage:i,generateResponseFunction:a,isTPAMessage:n,fixOldPingPongMessageType:function(e){return e.replace(t.PINGPONG_PREFIX,"")},handleTPAMessage:function(i,s,o,r){var p=void 0;try{r.data?p=JSON.parse(r.data):r.originalEvent&&r.originalEvent.data&&(r=r.originalEvent,p=JSON.parse(r.data))}catch(e){return}if(p&&n(p.intent))if(i)o(i,p,a(r.source,p));else{var c=(u=s,u.getSiteData().viewMode);"preview"===c&&{getSectionUrl:!0,siteInfo:!0,navigateToPage:!0,getExternalId:!0,smRequestLogin:!0,getValue:!0,getValues:!0,getCurrentPageAnchors:!0,getComponentInfo:!0,navigateToSectionPage:!0,isAppSectionInstalled:!0,getStateUrl:!0,getSitePages:!0,getSiteMap:!0,smCurrentMember:!0,refreshCurrentMember:!0}[p.type]&&(l=s,"preview"===l.getSiteData().viewMode&&e.get(window,"documentServices.tpa.__privates.areDocumentServicesHandlersReady")&&window.documentServices.tpa.__privates.areDocumentServicesHandlersReady())||(p.origin="site"===c?"viewer":c,o(s,p,a(r.source,p)))}else p&&(d=p.intent,d===t.TPA_MESSAGE_PREVIEW)&&o(i||s,p,a(r.source,p,t.TPA_PREVIEW_RESPONSE));var d,l,u}}}),define("tpa/handlers/anchorHandlers",["lodash","utils","coreUtils"],function(e,t,i){"use strict";var a=function(e){return{id:e.compId,title:e.name}},n=function(t,i){return e.map(i,a)};function s(t,i,a){var s=n(t,i);return e.some(s,{id:a})}return{getCurrentPageAnchors:function(e,t,i,a,s){s(n(i,a))},navigateToAnchor:function(e,t,a,n,o,r){var p=t.data.anchorId;if(p===i.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_COMP_ID)e.scrollToAnchor(i.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_ID);else if(p===i.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_COMP_ID)e.scrollToAnchor(i.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_ID);else if(s(a,n,p)){var c=o(p);c&&e.scrollToAnchor(c)}else r&&r({error:{message:'anchor with id "'+p+'" was not found on the current page.'}})},isAnchorExistsOnPage:s}}),define("tpa/services/tpaNavigationService",["lodash","coreUtils","tpa/bi/errors","tpa/handlers/anchorHandlers","tpa/services/clientSpecMapService"],function(e,t,i,a,n){"use strict";var s=function(e,t,i,a,n){if(i){var s=e.getSiteAspect("tpaCompStateAspect");t?(s.updateSectionUrlState(i,a),s.updateSectionUrlParams(i,n)):(s.updatePushState(i,a),s.reportStateChanged(i,a))}},o=function(e,t,a){var n={appDefinitionName:t||"",sectionId:a||""};e.reportBI(i.SDK_NAVIGATION_TO_SECTION_ERROR,n)},r=function(t,i,a,n,s,o,r){i.pageId===a?(t.updatePageNavInfo(i,n,s),o&&t.scrollSiteTo(0,0)):t.navigateToPage(i,n,s),e.isFunction(r)&&r()};return{navigateToSection:function(t,i,a,p,c,d,l,u,g){if(i){var m=void 0,h=void 0,f=void 0,v=void 0,I=!1,y=a.data||"",S=!0,P={};if(e.isObject(a.data)&&(S=e.get(a,"data.sectionIdentifier.shouldRefreshIframe",!0),y=e.get(a,"data.sectionIdentifier.state")||a.data.state||"",P=e.get(a,"data.sectionIdentifier.queryParams"),h=e.get(a,"data.sectionIdentifier.sectionId"),I=e.get(a,"data.sectionIdentifier.noTransition"),v=e.get(a.data,["sectionIdentifier","customizeTarget","pageBackground"])),e.isUndefined(p)||e.isEmpty(p))o(t,i.appDefinitionName,h),u({error:{message:'Page with app "'+i.appDefinitionName+'" was not found.'}});else{if(e.isUndefined(h))m=p[0].pageId,f=n.getMainSectionWidgetData(i);else{var A=e.find(p,{tpaPageId:h});if(e.isUndefined(A))return o(t,i.appDefinitionName,h),void u({error:{message:'App page with sectionId "'+h+'" was not found.'}});m=A.pageId,f=n.getWidgetDataByTpaPageId(i,h)}if(l(m))return o(t,i.appDefinitionName,h),void u({error:{message:"Can't navigate to a dynamic page. Please use the platform app API instead."}});var T=d(m);s(t,S,T,y,P);var w={pageId:m,tpaInnerRoute:y};if(!e.isEmpty(P))try{w.queryParams={appSectionParams:JSON.stringify(P)},w.hasAppSectionParams=!0}catch(e){}I&&(w.transition="none"),v&&(function(t){if(!e.startsWith(t,"rgba"))return!1;var i=(t=e(t).replace("rgba","").replace("(","").replace(")","")).split(",");if(4!==i.length)return!1;if(!e.every(i.slice(0,3),function(e){var t=e>=0&&e<=255,i=parseFloat(e),a=!isNaN(i)&&i>0&&i<=100;return t||a}))return!1;var a=e.last(i);return!a||a>=0&&a<=1}(v)?w.pageBackgroundColorOverride=v:u({error:{message:'Color should be rgba but "'+v+'" is not rgba format.'}}));var C=void 0;e.isFunction(g)&&(C=e.partial(g,e.get(f,"widgetId"),T)),r(t,w,c,void 0,void 0,!0,C)}}else{var D=e.get(a,"data.sectionIdentifier.appDefinitionId");D?(o(t),u({error:{message:'Application with appDefinitionId "'+D+'" was not found on the site.'}})):(o(t),u({error:{message:"Component was not found."}}))}},navigateWithoutClosingPopupIfPossible:r,navigateToPage:function(i,n,s,o,r,p,c){var d=e.get(n,"data.pageId"),l=e.get(n,"data.noTransition"),u=e.get(n,"data.anchorId"),g=r(d);s===d?u&&a.navigateToAnchor(i,n,d,g,p,c):t.linkUtils.navigateToPage(i,d,o,l,void 0,function(){u&&a.navigateToAnchor(i,n,d,g,p,c)},c)}}}),define("tpa/handlers/performanceHandlers",["tpa/bi/events"],function(e){"use strict";return{applicationLoaded:function(t,i){var a=t.getComponentById(i.compId);a&&a.reportPerformanceBiEvent&&a.reportPerformanceBiEvent(e.APP_LOADED_SUCCESSFULLY)},applicationLoadingStep:function(t,i){var a=t.getComponentById(i.compId);a&&a.reportPerformanceBiEvent&&a.reportPerformanceBiEvent(e.APP_LOADED_PARTIALLY,{stage:i.data.stage,stageNum:i.data.stageNum})}}}),define("tpa/handlers/tpaDummyHandlers",[],function(){"use strict";var e=function(){};return{toWixDate:e,getCompId:e,getOrigCompId:e,getWidth:e,getLocale:e,getCacheKiller:e,getTarget:e,getInstanceId:e,getSignDate:e,getUid:e,getPermissions:e,getIpAndPort:e,getDemoMode:e,getDeviceType:e,getInstanceValue:e,getSiteOwnerId:e,getImageUrl:e,getResizedImageUrl:e,getAudioUrl:e,getDocumentUrl:e,getSwfUrl:e,getPreviewSecureMusicUrl:e,getStyleParams:e,getStyleColorByKey:e,getColorByreference:e,getEditorFonts:e,getSiteTextPresets:e,getFontsSpriteUrl:e,getStyleFontByKey:e,getStyleFontByReference:e,getSiteColors:e,setUILIBParamValue:e,tpaWorker:{getViewMode:e,getDeviceType:e,getLocale:e,getInstanceId:e,getIpAndPort:e}}}),define("tpa/handlers/tpaHandlersCommon",["reactDOM","lodash","zepto"],function(e,t,i){"use strict";var a=function(e){if(t.isString(e)){var i=parseInt(e,10);return t.isNaN(i)?0:i}return t.isNumber(e)?e:0},n=function(e,a,n,s,o,r){var p=e.getComponentById(a);return{origCompId:a,applicationId:t.get(p,"props.compData.applicationId"),tpaData:(c=p,t.get(c,"props.compData.tpaData")),url:n,width:s,height:o,theme:r,windowSize:{width:i(window).width(),height:i(window).height()}};var c};return{openModal:function(e,i,a,s,o,r,p){var c,d=(c=e,c.getSiteAspect("tpaModalAspect")),l=function(e,i,a,s,o,r){var p=n(e,i,a,s,o,r);return t.omitBy(p,t.isUndefined)}(e,i,a,s,o,r);d.showModal(l,p)},openPopup:function(s,o,r,p,c,d,l,u){var g=s.getComponentById(o);if(h=g,t.includes(["wysiwyg.viewer.components.tpapps.TPAModal"],t.get(h,"props.structure.componentType"))){var m=new Error;throw m.name="Operation not supported",m.message="An app can not open a popup from a modal.",m}var h,f;(f=s,f.getSiteAspect("tpaPopupAspect")).showPopup(function(s,o,r,p,c,d,l){var u=s.getComponentById(o),g=n(s,o,r,p,c,d),m=e.findDOMNode(u);if(m){g.origCompStyle=i(m).offset();var h=m.getBoundingClientRect();g.origCompStyle.actualTop=h.top,g.origCompStyle.actualLeft=h.left}return g.position=t.defaults(l||{},{origin:"FIXED",placement:"CENTER",x:0,y:0}),g.position.x=a(g.position.x),g.position.y=a(g.position.y),t.omitBy(g,t.isUndefined)}(s,o,r,p,c,d,l),u)}}}),define("tpa/handlers/tpaHandlers",["zepto","lodash","coreUtils","core","utils","reactDOM","tpa/utils/sitePages","tpa/services/pageService","tpa/services/clientSpecMapService","tpa/services/tpaNavigationService","tpa/utils/tpaUtils","tpa/bi/errors","tpa/handlers/anchorHandlers","tpa/handlers/performanceHandlers","tpa/handlers/tpaDummyHandlers","tpa/handlers/tpaHandlersCommon","tpa/common/tpaMetaData","tpa/bi/events","experiment"],function(e,t,i,a,n,s,o,r,p,c,d,l,u,g,m,h,f,v,I){"use strict";var y=n.logger,S=a.activityTypes.TPAActivity,P=a.activityService,A="QUICK_ACTION_BAR",T="notifyWidget",w="APP";function C(e){return e.getSiteAspect("siteMembers")}var D=function(e,t,i){var a={},n=e.getSiteData().getDataByQuery(e.getSiteData().getCurrentUrlPageId()),s=e.getSiteData().getCurrentUrlPageTitle();d.sdkVersionIsAtLeast(t.version,"1.42.0")?a.pageTitle=s:(a.siteTitle=s,a.pageTitle=n.title),a.pageTitleOnly=e.getSiteData().getCurrentUrlPageName(),a.siteDescription=n.descriptionSEO,a.siteKeywords=n.metaKeywordsSEO;var o=e.getSiteData().currentUrl;a.url=o.full,a.baseUrl=e.getSiteData().getExternalBaseUrl(),a.referer=window.document.referrer,i(a)},b=function(e,t){e&&e({error:{message:t}})},M=function(e,i,a){var n={filterHideFromMenuPages:!0,includePagesUrl:t.get(i,"data.includePagesUrl",!1),includeIsHomePage:!0,enhancedInfo:!1};a(o.getSitePagesInfoData(e.getSiteData(),n))},E=function(e,t,i){i(o.getSitePagesInfoData(e.getSiteData(),{filterHideFromMenuPages:!0,includePagesUrl:!1,includeIsHomePage:!1,enhancedInfo:!0}))},_=function(e,i,a){var n=void 0,s=e.getComponentById(i.compId),o=t.get(i,"data.sectionIdentifier.appDefinitionId");o?n=d.getAppDataByAppDefinitionId(e,o):s&&(n=s.getAppData());var p=t.get(n,"applicationId"),l=r.mapPageToWidgets(e),u=t.get(l,p),g=e.getSiteData().getPrimaryPageId();c.navigateToSection(e,n,i,u,g,function(i){var a=e.getComponentsByPageId(i),n=t.find(a,"isTPASection");return t.get(n,"props.id")},e.getSiteData().isDynamicPage,a,t.partial(re,e,n))},x=function(e,i,a,n,s){var o=e.getSiteData();if(n=n||o.getFocusedRootId(),(i=i||U(e,a,n))&&(R(i)||i.props.rootId===n)){var r=O(i,e);o.animations.animate("BaseScroll",e.getSiteContainer(),1,0,{y:r.y,x:r.x,callbacks:{onComplete:s}})}else{s({error:{message:(t.isEmpty(n)?"Current page":'Page id "'+n+'"')+' does not contain the component id "'+a+'".'}})}},R=function(e){return"masterPage"===e.props.rootId},U=function(e,t,i){return e.getComponentsByPageId(i)[t]},O=function(e,i){var a=i.getSiteData(),o=s.findDOMNode(e),r=a.measureMap.siteMarginTop||0,p=n.domMeasurements.getElementRect(o),c=p.top+r;t.get(a,"measureMap.custom.SITE_HEADER.isFixedPosition")&&(c-=a.measureMap.height.SITE_HEADER);var d=n.scrollAnchors.normalizeYOffset(c,a);return{x:p.left,y:d}},N=function(e,i){var a=e.getBoundingClientRect(),n=t(a).pick(["left","right","top","bottom","height","width"]).mapValues(function(e){return Math.floor(e)}).value();return i&&(n.top-=i),n},k=function(e,t){return{x:e.left,y:e.top-t}},B=function(e){return t.isString(e)&&/^[0-9]+%$/.test(e)},W=function(e,t){var i=t.data.eventKey;if("QUICK_ACTION_TRIGGERED"!==i){var a=e.getComponentById(t.compId);a&&a.isCompListensTo&&!a.isCompListensTo(i)&&a.startListen(i)}else!L(e,i,t.compId)&&e.getSiteData().isViewerMode()&&G(e,t.compId)},L=function(e,i,a){var n=V(e,a),s=e.getRuntimeDal().getActionsAndBehaviors(A),o=t(s).filter({action:{sourceId:A,name:n}}).filter({behavior:{targetId:a}}).filter({behavior:{name:T}}).value();return!t.isEmpty(o)},G=function(e,t){var i,a,n=V(e,t),s=(i=t,a=n,{action:{type:"comp",name:a,sourceId:A},behavior:{type:"comp",targetId:i,name:T,params:{sourceId:A,action:a}}});e.getRuntimeDal().addActionsAndBehaviors(A,s)};var F=function(e,t){var i=t.data.eventKey||t.data;if("QUICK_ACTION_TRIGGERED"!==i){var a=e.getComponentById(t.compId);a&&a.stopListen(i)}else H(e,t.compId)},H=function(e,t){var i=V(e,t);e.getRuntimeDal().removeActionsAndBehaviors(A,{action:{name:i}})};function V(e,i){var a=e.getComponentById(i),n=t.get(a,"props.compData.applicationId");return e.getSiteData().getClientSpecMap()[n].appDefinitionId}var q=function(e,i,a,n){if(d.isTPASection(i)){i.setState({pushState:n});var s=i.getAppData(),o=t.get(i,"props.compData.widgetId")||t.get(p.getMainSectionWidgetData(s),"widgetId"),r=e.getSiteData().getPrimaryPageId();c.navigateWithoutClosingPopupIfPossible(e,{pageId:a,tpaInnerRoute:n,transition:"none"},r,void 0,void 0,void 0,t.partial(re,e,s,o,i.props.id))}},z=function(e,t,i,a){i.getMemberDetails(function(t){null!==t?(a(t),e&&e.setSiteMemberDataState(null)):e?e.setSiteMemberDataState({callback:a}):a(null)})},K=function(e,t,i){var a=e.getComponentById(t.compId),n=C(e);n.isLoggedIn()?z(a,0,n,function(e){i(e)}):i(null)},Q=function(e,i){var a=t.get(i,"data.pixelId"),n=t.get(i,"data.pixelType");a&&"FACEBOOK"===n&&e.initFacebookRemarketing(a)},j=function(e,i){var a=t.get(i,"data",{}),n=t.get(i,"data.eventName");n&&(delete a.eventName,e.fireFacebookRemarketingPixel(n,a))},Y=function(e){var t=e.getSiteData();return{hubSecurityToken:t.getHubSecurityToken(),svSession:t.getSvSession(),metaSiteId:t.getMetaSiteId(),currentUrl:t.getCurrentUrl()}},X=function(e,i){var a=d.getAppData(e,i.compId),n=i.data;return{type:t.get(n,"activity.type")||"TPA",appDefinitionId:a.appDefinitionId||"TPA",info:t.get(n,"activity.info")||{},details:t.get(n,"activity.details")||{},contactUpdate:t.get(n,"activity.contactUpdate")||{},instance:a.instance}},J=function(e,i,a){var n=e.getComponentById(i.compId);n&&n.setAppIsAlive&&n.setAppIsAlive(),t.get(n,"hasOrigComponent")&&a($(e,n))},$=function(e,i){var a=e.getSiteData(),s=a.getAllTheme(),o=i&&i.hasOrigComponent()?e.getComponentById(i.getOrigComponentId()):i,r=t.get(o,"props.structure.styleId"),p=a.rendererModel.siteInfo.documentType,c=a.getDataByQuery("masterPage").characterSets,d=a.isVisualFocusEnabled(),l=e.isExperimentOpen("sv_newFonts2017"),u=n.styleUtils.getStyleDataToPassIntoApp(r,s,a.santaBase,p,c,a.serviceTopology,!0,l);return t.assign(u,{isVisualFocusEnabled:d})},Z=function(e,i,a){var n=i.data.key,s=i.data.scope,o=e.getSiteData(),r=e.getComponentById(i.compId).props.compData,p=void 0;if(s===w)p=te(o,n,"tpaData-"+r.applicationId,"masterPage");else{var c=e.getRootOfComponentId(i.compId);p=te(o,n,r.tpaData,c)}t.isEmpty(p)?a({error:{message:"key "+n+" not found in "+s+" scope"}}):a(p)},ee=function(e,i,a){var n=t.uniq(i.data.keys),s=e.getSiteData(),o=e.getRootOfComponentId(i.compId),r=e.getComponentById(i.compId,o).props.compData,p=i.data.scope,c=void 0;if(p===w){var d=ie(s,"tpaData-"+r.applicationId,"masterPage");c=t.pick(d,n)}else{var l=ie(s,r.tpaData,o);c=t.pick(l,n)}if(!t.isEmpty(c)&&t(c).keys().isEqual(n))a(c);else{var u=t.keys(c);a({error:{message:"keys "+t(u).xor(n).intersection(n).value()+" not found in "+p+" scope"}})}},te=function(e,i,a,n){if(!t.isEmpty(a)){var s=ie(e,a,n);if(s)return t.pick(s,i)}return null},ie=function(e,t,i){var a=e.getDataByQuery(t,i);return a&&a.content?JSON.parse(a.content):null},ae=function(e,i){return{width:t.get(e,"measureMap.width.WIX_ADS"+i),height:t.get(e,"measureMap.height.WIX_ADS"+i),top:t.get(e,"measureMap.top.WIX_ADS"+i),left:t.get(e,"measureMap.left.WIX_ADS"+i)}};function ne(e,i,a){var n=null,s=e.getComponentById(i,a);if(s){var o=t.get(s.props,"compData.applicationId")||null;n=e.getSiteData().getClientSpecMapEntry(o)||null}return n||{}}var se=function(e,t){var i=e.getComponentById(t).props.compData;return i&&i.id},oe=function(e,i,a){var n=e.getSiteData(),s=void 0,o=t.get(i,["data","appDefinitionId"]);if(o)s=p.getAppDataByAppDefinitionId(n,o);else{s=e.getComponentById(i.compId).getAppData()}var c=t.get(s,"applicationId"),d=r.mapPageToWidgets(e),l=t.get(d,c);a(t.some(l,{tpaPageId:t.get(i,["data","sectionId"])}))},re=function(e,i,a,n){var s=e.getSiteData().biData,o=s.getTime(),r={compId:n,pageId:s.getPageId(),pageNo:s.getPageNumber(),loadingTime:o.loadingTime,totalLoadingTime:o.totalLoadingTime};t.get(i,"isWixTPA")?(r.widgetId=a,r.appDefinitionId=t.get(i,"appDefinitionId")):(r.externalWidgetId=a,r.externalAppDefinitionId=t.get(i,"appDefinitionId")),y.reportBI(e.getSiteData(),v.APP_STATE_CHANGED,r)};return t.merge({waitForWixCodeWorkerToBeReady:function(e,t,i){var a=e.getSiteAspect("WidgetAspect"),n=e.getSiteData().getCurrentUrlPageId(),s=a.isContextReady(n);e.getSiteAspect("wixCodeWidgetAspect").isAppInitiated()?s?i({}):a.registerToOnWidgetReady(n,function(){i({})}):i({error:!0})},siteInfo:D,heightChanged:function(e,t){var i="number"==typeof t.data?t.data:t.data.height;if(i>1e6){var a={height:i};y.reportBI(e.getSiteData(),l.SDK_SET_HEIGHT_ERROR,a)}var n={height:i,ignoreAnchors:t.data.overflow},s=e.getComponentById(t.compId);s.registerReLayout(),s.setState(n)},registerEventListener:W,removeEventListener:F,navigateTo:function(e,a,n){var s=t.get(a,"data.link");i.linkUtils.navigateToLink(e,s,n)},navigateToPage:function(e,i,a){var s=e.getSiteData().getPrimaryPageId(),o=e.getSiteData().getAllPageIds();c.navigateToPage(e,i,s,o,function(t){var i=d.Constants.TOP_PAGE_ANCHOR_PREFIX+t;return n.scrollAnchors.getPageAnchors(e.getSiteData(),t,i)},t.partial(se,e),a)},smRequestLogin:function(e,i,a){var n=e.getComponentById(i.compId),s=C(e);if(s.isLoggedIn())z(n,0,s,function(e){a({authResponse:!0,data:e})});else{var o=t.get(i,"data.mode"),r=o&&"login"===o,p=t.get(i,"data.language","en"),c=void 0;t.get(i,"data.callOnCancel")&&(c=function(){a({wasCancelled:!0})}),s.showAuthenticationDialog({successCallback:function(e){a({authResponse:!0,data:e})},cancelCallback:c,language:p,showLoginDialog:r,appId:d.getAppDefId(e,i.compId),checkCommunityCheckbox:t.get(i,"data.checkCommunityCheckbox")})}},smCurrentMember:K,refreshCurrentMember:function(e){var t=C(e);t.isLoggedIn()&&t.getMemberDetails(null,null,!0)},scrollBy:function(e,t,i){e.scrollSiteBy(t.data.x,t.data.y,i)},scrollTo:function(e,i,a){i.data.scrollAnimation?e.getSiteData().animations.animate("BaseScroll",e.getSiteContainer?e.getSiteContainer():e._site.props.getSiteContainer(),1,0,{y:i.data.y,x:i.data.x,callbacks:{onComplete:function(){a&&a()}}}):e.getSiteAspect("windowScrollEvent").scrollSiteTo(i.data.x,i.data.y,t.isFunction(a)&&a)},navigateToComponent:function(e,a,n){var s=a.data.pageId,o=a.data.compId,r=e.getSiteData().getFocusedRootId(),p=e.getComponentById(o);if(p&&"wysiwyg.viewer.components.tpapps.TPAGluedWidget"===p.props.structure.componentType)n({error:{message:"Navigation to glued widget not supported."}});else if(t.isEmpty(s)||s===r)x(e,p,o,s,n);else{var c=e.getSiteData().getAllPageIds();i.linkUtils.navigateToPage(e,s,c,a.data.noPageTransition,void 0,x.bind(null,e,p,o,s,n),n)}},registerCampaignPixel:Q,reportCampaignEvent:j,postActivity:function(e,t){var i=e.getComponentById(t.compId),a=Y(e),n=X(e,t),s=function(e){i.sendPostMessage({intent:"TPA_RESPONSE",compId:t.compId,callId:t.callId,type:t.type,status:e.status,res:{response:{activityId:e.response.activityId,contactId:e.response.contactId},status:e.status}})},o=new S(a,n);P.reportActivity(e.getSiteData().getExternalBaseUrl(),o,function(t){t.userSessionToken&&e.setUserSession(t.userSessionToken),s({status:!0,response:t})},function(e){var t={status:e.status,statusText:e.statusText,responseText:e.responseText};s({status:!1,response:t})})},getCurrentPageId:function(e,t,i){i(e.getSiteData().getCurrentUrlPageId())},getCurrentPageNavigationInfo:function(e,t,i){var a=e.getSiteData().getRootNavigationInfo(),n={};a.routerDefinition?(n.innerRoute=a.innerRoute,n.type="DynamicPageLink",n.routerId=a.routerDefinition.routerId):(n.type="PageLink",n.pageId=a.pageId),i(n)},getUserSession:function(e,t,i){i(e.getUserSession())},boundingRectAndOffsets:function(i,a,n){var o=i.getSiteData(),r=i.getComponentById(a.compId),p=s.findDOMNode(r),c=0;t.get(o,"measureMap.custom.SITE_HEADER.isFixedPosition")&&(c=o.measureMap.height.SITE_HEADER);var d=i.getRenderFlag("siteScale")||1;n({rect:N(p,c),offsets:k(e(p).offset(),c),scale:d})},navigateToSectionPage:_,getSitePages:M,getSiteMap:E,appIsAlive:J,openModal:function(e,t,i){var a=t.data||{};h.openModal(e,t.compId,a.url,a.width,a.height,a.theme,i)},openPopup:function(e,t,i){var a=t.data||{};h.openPopup(e,t.compId,a.url,a.width,a.height,a.theme,a.position,i)},closeWindow:function(e,t){var i=e.getComponentById(t.compId);i&&i.hide&&i.hide(t.data)},setFullScreenMobile:function(e,i,a){if(e.getSiteData().isMobileView()){var n=i.data.isFullScreen,s=i.compId,o=e.getComponentById(s);!function(e,i){var a=ne(e,i);return t.includes(f.PERMITTED_FULL_SCREEN_TPAS_IN_MOBILE,a.appDefinitionId)}(e,s)?a&&a():n?(e.enterFullScreenMode(),e.setSiteRootHiddenState(!0),o.enterFullScreen(a)):(e.setSiteRootHiddenState(!1),e.exitFullScreenMode(),o.exitFullScreen(a))}else a({error:{message:"show full screen is only available in Mobile view"}})},resizeWindow:function(e,i,a){var n=i.data.width,s=i.data.height;B(n)||(n=parseFloat(n)),B(s)||(s=parseFloat(s));var o=e.getComponentById(i.compId);(r=o)&&r.resizeWindow&&t.includes(["wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAPopup","wysiwyg.viewer.components.tpapps.TPAModal"],r.props.structure.componentType)&&o.resizeWindow(n,s,a);var r},appStateChanged:function(e,t){var i="string"==typeof t.data?t.data:t.data.state,a=e.getComponentById(t.compId),s=void 0,o=e.getRootOfComponentId(t.compId),r=e.getSiteData().getExistingRootNavigationInfo(o),p=r?r.pageId:o;try{switch((s=JSON.parse(i)).cmd){case"zoom":a.processImageZoom(s);break;case"itemClicked":a.processItemClicked(s);break;case"itemChanged":a.processItemChanged(s);break;case"componentReady":a.setComponentInIframeReady();break;case"navigateToDynamicPage":var c=s.args[0],d=n.wixUrlParser.getUrl(e.getSiteData(),c),l=n.wixUrlParser.parseUrl(e.getSiteData(),d);s.args[1]&&(l.anchorData=s.args[1]),e.handleNavigation(l,s.args[2]);break;case"navigateToAnchor":var u=s.args[0],g=s.args[1];e.getSiteData().getPrimaryPageId()===u?g&&e.scrollToAnchor(g):e.navigateToPage({pageId:u,pageAdditionalData:null,anchorData:g});break;default:q(e,a,p,i)}}catch(t){q(e,a,p,i)}},getSectionUrl:function(e,i,a){var n=e.getComponentById(i.compId);if(n){var s=r.mapPageToWidgets(e),o=e.getSiteData().getClientSpecMap()[n.props.compData.applicationId],p=o.applicationId;if(t.isEmpty(s)||t.isUndefined(s[p]))a({error:{message:'Page with app "'+o.appDefinitionName+'" was not found.'}});else{var c=s[p],d=i.data.sectionIdentifier,l=t.find(c,{tpaPageId:d})||c[0],u=void 0;if(l&&(u=l.pageId),t.isUndefined(u))a({error:{message:"Page was not found."}});else{var g=e.getPageUrlFor(u);t.isUndefined(g)?a({error:{message:"Page was not found."}}):a({url:g})}}}else a({error:{message:"Component was not found."}})},postCountersReport:function(e,i,a){i.data.messageId=Date.now();var s={ctToken:e.getSiteData().getCTToken()},o=t.omit(i.data,"version"),r="//player-counters.wix.com/collector/rest/collect-js?"+n.urlUtils.toQueryString(s);n.ajaxLibrary.ajax({type:"OPTIONS",url:r,data:JSON.stringify(o),dataType:"json",contentType:"application/json",success:function(e){a({status:"success",response:e})},error:function(e){var t=e&&e.responseText;a({status:"error",response:t})}})},getExternalId:function(e,t,i){var a=e.getComponentById(t.compId);a&&i(a.props.compData.referenceId)},getViewMode:function(e,t,i){i({editMode:e.getSiteData().isViewerMode()?"site":e.getRenderFlag("componentViewMode")})},getValue:Z,getValues:ee,getCurrentPageAnchors:function(e,t,i){var a=e.getSiteData().getCurrentUrlPageId(),s=d.Constants.TOP_PAGE_ANCHOR_PREFIX+a,o=n.scrollAnchors.getPageAnchors(e.getSiteData(),a,s);u.getCurrentPageAnchors(e,t,a,o,i)},navigateToAnchor:function(e,i,a){var s=e.getSiteData().getCurrentUrlPageId(),o=d.Constants.TOP_PAGE_ANCHOR_PREFIX+s,r=n.scrollAnchors.getPageAnchors(e.getSiteData(),s,o);u.navigateToAnchor(e,i,s,r,t.partial(se,e),a)},getStateUrl:function(e,i,a){var s=e.getComponentById(i.compId);if(!s)return a({error:{message:"Component was not found."}});var o=r.mapPageToWidgets(e),p=e.getSiteData().getClientSpecMap()[s.props.compData.applicationId],c=p.applicationId;if(t.isEmpty(o)||t.isUndefined(o[c]))return a({error:{message:'Page with app "'+p.appDefinitionName+'" was not found.'}});var d=o[c],l=t.find(d,{tpaPageId:i.data.sectionId}),u=void 0;return u=l?{pageId:l.pageId,tpaInnerRoute:i.data.state}:{pageId:d[0].pageId},e.getSiteData().isDynamicPage(u.pageId)?a({error:{message:"Can't retrieve url for a dynamic page. Please use the platform app API instead."}}):a({url:n.wixUrlParser.getUrl(e.getSiteData(),u,void 0,!0)})},getComponentInfo:function(e,i,a){var n=e.getComponentById(i.compId),s=n.props.compData,o=n.getAppData(),r=R(n),c=s.widgetId?o.widgets[s.widgetId]:p.getMainSectionWidgetData(o);a({compId:i.compId,showOnAllPages:r,pageId:r?"":n.props.pageId,tpaWidgetId:t.get(c,"tpaWidgetId",""),appPageId:t.get(c,"appPage.id","")})},getStyleId:function(e,t,i){i(e.getComponentById(t.compId).props.structure.styleId)},getStyleParamsByStyleId:function(e,i,a){var s=e.getSiteData(),o=i.data.styleId;if(t.isUndefined(s.getAllTheme()[o]))a({error:{message:'Style id "'+o+'" was not found.'}});else{var r=s.getAllTheme(),p=s.rendererModel.siteInfo.documentType,c=s.getDataByQuery("masterPage").characterSets;a(n.styleUtils.getStylesForSDK(r,o,!0,s.serviceTopology,p,c,!0))}},replaceSectionState:function(e,i){var a=e.getComponentById(i.compId),n=i.data.state,s=e.getRootOfComponentId(i.compId);if(d.isTPASection(a)){a.setState({pushState:n});var o=a.getAppData(),r=e.getSiteData().getPrimaryPageId(),l=t.get(a,"props.compData.widgetId")||t.get(p.getMainSectionWidgetData(o),"widgetId");c.navigateWithoutClosingPopupIfPossible(e,{pageId:s,tpaInnerRoute:n,transition:"none"},r,!1,!0,void 0,t.partial(re,e,o,l,i.compId))}},logOutCurrentMember:function(e,i,a){var n=C(e);if(n.isLoggedIn()){var s=t.get(i,"data.language");n.logout(s)}else a({onError:"No member is logged in"})},getCtToken:function(e,i,a){t.isFunction(a)&&a(e.getSiteData().getCTToken())},setPageMetadata:function(e,i,a){var n=e.getComponentById(i.compId);if(n){var s=d.isTPASection(n),o=t.get(n,"props.pageId")===e.getSiteData().getCurrentUrlPageId();if(!s)return void b(a,"Setting a page meta data is possible only to TPA Sections and MultiSections");if(!o)return void b(a,"Setting a page meta data is possible only to component that is located on the current page");var r=e.getPageData(),p=t.get(r,"title",""),c=t.get(i,"data.title"),l=t.get(i,"data.fullTitle"),u=t.get(i,"data.description")||t.get(r,"descriptionSEO",""),g=t.get(e.getSiteData(),"rendererModel.siteInfo.siteTitleSEO"),m=void 0;if(l){var h=n.getAppData(),f=t.get(h,"isWixTPA"),v="wysiwyg.viewer.components.tpapps.TPAMultiSection"===t.get(n,"props.structure.componentType");if(f&&v)return void e.setRunTimePageTitle(p,u,l);v||b(a,"Setting a full title is possible to TPA Multisections only")}c&&(m=I.isOpen("sv_tpaSetPageMetadata",e.getSiteData())?c+" | "+g:g+" | "+c),e.setRunTimePageTitle(p,u,m)}},applicationLoaded:g.applicationLoaded,applicationLoadingStep:g.applicationLoadingStep,getAdsOnPage:function(e,t,i){var a=e.getSiteData();a.shouldShowWixAds()?I.isOpen("displayWixAdsNewVersion",a)?i({top:ae(a,"top")}):a.isMobileView()?i({top:ae(a,"top")}):i({top:ae(a,"top"),bottom:ae(a,"bottom")}):i({})},setMobileActionBarButton:function(e,i,a){var n=ne(e,(i=i||{}).compId).appDefinitionId;n||a({error:{message:"No matching app definition found for comp id "+i.compId}});var s=function(e){var i={};return t.isBoolean(e.visible)&&(i.enabled=e.visible),t.isBoolean(e.notifications)&&(i.notificationCount=e.notifications?1:0),t.isString(e.color)&&(i.color=e.color),i}(i.data||{});!t.isEmpty(s)&&(s.appId=n,(o=e,o.getSiteAspect("QuickActionBarAspect")).updateDynamicActions(s));var o;a&&a()},isAppSectionInstalled:oe,hasLoginOnPage:function(e,i,a){var n="wysiwyg.viewer.components.LoginSocialBar",s=e.getSiteData().getFocusedRootId(),o=e.getComponentsByPageId(s),r=t.some(o,["props.structure.componentType",n]);r||e.isPageLandingPage(s)||e.getSiteData().isPopupPage(s)||(o=e.getComponentsByPageId("masterPage"),r=t.some(o,["props.structure.componentType",n])),a(r)},registerApi:function(e,i){var a=e.getComponentById(i.compId),n=t.get(a.getIframe(),"id");e.getSiteAspect("TPARPCAspect").registerApi(n,i.compId)},requireSingletonAPI:function(e,i,a){var n=t.get(i.data,"appDefId"),s=t.get(i.data,"componentType");e.getSiteAspect("TPARPCAspect").requireSingletonAPI(n,s,a)},trackEvent:function(e,i){var a=t.get(i,"data.eventName"),s=t.get(i,"data.params"),o=t.get(i,"data.options");n.integrations.promoteAnalytics.trackEvent(e,a,s,o)},revalidateSession:function(e,i,a){var n=e.getComponentById(i.compId).getAppData(),s=t.get(n,"applicationId");e.getSiteAspect("dynamicClientSpecMap").getNewAppInstance(s,function(e){a(e?{instance:e}:{error:{message:"Error getting new instance from server"}})})},tpaWorker:{siteInfo:D,getSitePages:M,getSiteMap:E,removeEventListener:F,registerEventListener:W,registerCampaignPixel:Q,reportCampaignEvent:j,smCurrentMember:K,appIsAlive:J,navigateToSectionPage:_,getValue:Z,getValues:ee,applicationLoaded:g.applicationLoaded,applicationLoadingStep:g.applicationLoadingStep,isAppSectionInstalled:oe}},m)}),define("tpa/common/tpaBi",["lodash","tpa/utils/tpaUtils","tpa/bi/events","utils"],function(e,t,i,a){"use strict";var n={};return{sendBIEvent:function(s,o,r,p,c){var d,l,u=(d=s,l=r,d.widgetId=e.get(l,"widgetId"),d.appId=e.get(l,"applicationId"),d);if(g=u,r&&g.version&&g.type&&g.namespace){var g,m=e.get(r,"applicationId"),h={count:1,target:1};if(e.has(n,[m,s.type])?++(h=e.get(n,[m,s.type])).count:(n[m]||(n[m]={}),n[m][s.type]=h),h.count===h.target){var f={visitorUuid:t.getVisitorUuid(a),sdkVersion:u.version,origin:o,fnName:u.type,param:JSON.stringify(s.data),namespace:u.namespace,count:h.count};if(u.appId){var v=function(e,i){var a=t.getInstanceFromClientSpecMap(i,e.appId);if(!i[e.appId])throw new Error("app definition could not be found by the given appId");return{appId:i[e.appId].appDefinitionId,instanceId:a.instanceId,isPublished:function(e,t){var i=e.widgets[t];return(i?i.published||i.santaEditorPublished:e.sectionPublished)?1:0}(i[e.appId],e.widgetId)}}(u,p);e.merge(f,v)}c(u.appId?i.JS_SDK_FUNCTION_CALL:i.GALLERY_FUNCTION_CALL,f),h.target*=10}}}}}),define("tpa/skins/skins.json",[],function(){"use strict";var e={};return e["wysiwyg.viewer.skins.TPAModalSkin"]={react:[["div","blockingLayer",[],{}],["div","dialog",[],{},["div","frameWrap",[],{},["iframe","iframe",[],{allowFullScreen:!0,frameBorder:0}],["div","errorMessage",[],{}],["div","xButton",[],{}]]]],params:{rd:"BORDER_RADIUS","bg-block":"BG_COLOR"},paramsDefaults:{rd:"1px","bg-block":"#555"},paramsMutators:{"bg-block":{type:"alpha",value:.75}},css:{"%":"position:fixed;width:100%;height:100%;z-index:100000;","%blockingLayer":"background-color:[bg-block];position:fixed;top:0;right:0;bottom:0;left:0;width:100%;height:100%;overflow:hidden;z-index:999;",'%[data-state~="mobile"] %blockingLayer':"display:none;",'%[data-state~="mobile"] %dialog':"position:fixed;top:0;left:0;width:100%;height:100%;margin:0;","%dialog":"position:fixed;top:50%;left:50%;width:200px;height:200px;margin-top:-100px;margin-left:-100px;z-index:1000;","%frameWrap":"overflow:hidden;background:#fff;width:100%;height:100%;position:relative;z-index:1001;border:1px solid #e8e2e2;","%iframe":"position:absolute;width:100%;height:100%;[rd]","%xButton":"position:absolute;z-index:1002;margin-top:4px;right:9px;font-family:courier;font-size:24px;font-weight:bold;cursor:pointer;color:#a1a1a1;","%xButton:hover":"color:#373737;"}},e["wysiwyg.viewer.skins.TPAPopupSkin"]={react:[["div","frameWrap",[],{},["div","closeButton",[],{}],["iframe","iframe",[],{}]]],params:{shd:"BOX_SHADOW",rd:"BORDER_RADIUS",tdr:"URL"},paramsDefaults:{shd:"4px 4px 15px rgba(0, 0, 0, 0.4)",rd:"3px",tdr:"BASE_THEME_DIRECTORY"},css:{"%":"background:#fff;overflow:hidden;z-index:100000;[shd]  [rd]","%iframe":"position:absolute;width:100%;height:100%;z-index:1000;","%closeButton":"position:absolute;z-index:1001;top:10px;right:10px;cursor:pointer;background:transparent url([tdr]popup_close_x.png) no-repeat right top;height:24px;width:24px;"}},e["wysiwyg.viewer.skins.TPAPreloaderSkin"]={react:[["div","content",[],{},["div","preloader",[],{}],["span","loadingText",[],{}]]],css:{"%":"position:absolute;top:0;left:0;color:#373737;width:100%;height:100%;","%content":"width:100%;height:100%;"}},e["wysiwyg.viewer.skins.TPASectionSkin"]={react:[["iframe","iframe",[],{}],["div","overlay",[],{}]],exports:{preloaderOverlay:{skin:"wysiwyg.viewer.skins.TPAPreloaderSkin",styleGroup:"preloaderStyleGroup"},unavailableMessageOverlay:{skin:"wysiwyg.viewer.skins.TPAUnavailableMessageOverlaySkin",styleGroup:"tpaUnavailableMessageOverlaySkinStyleGroup"}},css:{"%iframe":"overflow:hidden;position:absolute;width:100%;height:100%;display:block;",'%[data-state~="iframeNotShown"] %iframe':"display:none;",'%[data-state~="iframeRenderedInvisible"] %iframe':"visibility:hidden;"}},e["wysiwyg.viewer.skins.TPAUnavailableMessageOverlaySkin"]={react:[["div","content",[],{},["div","iconContainer",[],{},["img","unavailableIcon",[],{}]],["div","textTitle",[],{}],["div","textContainer",[],{},["span","text",[],{}],["a","reloadButton",[],{}],["span","dismissButton",[],{},["a",null,[],{},"Dismiss"]]]]],css:{"%":"position:absolute;top:0;left:0;color:#373737;width:100%;height:100%;","%content":"width:100%;height:100%;background:rgba(255, 255, 255, 0.9);font-size:0;margin-top:5px;","%textContainer":'color:#373737;font-family:"Helvetica Neue", "HelveticaNeueW01-55Roma", "HelveticaNeueW02-55Roma", "HelveticaNeueW10-55Roma", Helvetica, Arial, sans-serif;font-size:14px;display:inline-block;vertical-align:middle;width:100%;margin-top:10px;text-align:center;',"%reloadButton":"display:inline-block;","% a":"color:#0099FF;text-decoration:underline;cursor:pointer;","%iconContainer":"display:none;","%dismissButton":"display:none;","%textTitle":'font-family:"Helvetica Neue", "HelveticaNeueW01-55Roma", "HelveticaNeueW02-55Roma", "HelveticaNeueW10-55Roma", Helvetica, Arial, sans-serif;display:none;','%[data-state~="hideIframe"] %_buttons':"opacity:1;",'%[data-state~="hideOverlay"]':"display:none;"}},e["wysiwyg.viewer.skins.TPAWidgetSkin"]={react:[["iframe","iframe",[],{}],["div","overlay",[],{}]],exports:{preloaderOverlay:{skin:"wysiwyg.viewer.skins.TPAPreloaderSkin",styleGroup:"preloaderStyleGroup"},unavailableMessageOverlay:{skin:"wysiwyg.viewer.skins.TPAUnavailableMessageOverlaySkin",styleGroup:"tpaUnavailableMessageOverlaySkinStyleGroup"}},css:{"%":"overflow:hidden;","% iframe":"position:absolute;width:100%;height:100%;overflow:hidden;"}},e}),define("tpa/aspects/TPAWorkerAspect",["lodash"],function(e){"use strict";function t(e){this._aspectSiteAPI=e}return t.prototype={getComponentsToRender:function(){var t=this._aspectSiteAPI.getSiteData().getClientSpecMap(),i=this.getTPAWorkers(t);return e.map(i,function(e){var t="tpaWorker_"+e.applicationId;return{structure:(i=t,{componentType:"tpa.viewer.classes.TPAWorker",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",type:"Component",id:i}),props:{compData:e}};var i})},getTPAWorkers:function(t){return e.filter(t,function(t){return e.isString(t.appWorkerUrl)&&t.permissions&&!t.permissions.revoked})}},t}),define("tpa/handlers/tpaPubSubHandlers",["tpa/utils/tpaUtils","utils","tpa/bi/errors"],function(e,t,i){"use strict";var a=t.logger;return{registerEventListener:function(e,t){e.getSiteAspect("tpaPubSubAspect").subscribe(t)},publish:function(t,n){var s=n.data,o=n.compId,r=e.getAppDefId(t,o);r?(s.eventKey=e.stripPubSubPrefix(s.eventKey),t.getSiteAspect("tpaPubSubAspect").publish(r,o,s)):a.reportBI(t.getSiteData(),i.SDK_PUBSUB_PUBLISH_ERROR)},removeEventListener:function(t,i){var a=i.compId,n=i.data,s=e.getAppDefId(t,a),o=e.stripPubSubPrefix(n.eventKey);t.getSiteAspect("tpaPubSubAspect").unsubscribe(s,a,o)}}}),define("tpa/aspects/TPAPostMessageAspect",["lodash","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/handlers/tpaPubSubHandlers","tpa/handlers/tpaHandlersCommon","tpa/utils/tpaUtils","tpa/common/tpaBi","tpa/services/clientSpecMapService","tpa/mixins/tpaCompApiMixin","tpa/common/supportedSiteEvents","pmrpc","utils"],function(e,t,i,a,n,s,o,r,p,c,d,l){"use strict";var u={getCtToken:!0,refreshCurrentMember:!0};var g=function(t){if(e.has(t,"data")&&!e.isNull(t.data))return t.data.eventKey&&l.stringUtils.startsWith(t.data.eventKey,s.Constants.TPA_PUB_SUB_PREFIX)},m=function(e){if(g(e))return a;if((t=e.compId)&&l.stringUtils.startsWith(t,"tpaWorker_"))return i.tpaWorker;var t;return i},h=function(i,a,n){if(function(t,i,a){var n=i&&t.getComponentById(i);return("appStateChanged"!==a||n&&e.includes(t.getAllRenderedRootIds(),n.props.rootId))&&(s=t,o=i,p=a,!u[p]||r.isSuperAppByCompId(s,o));var s,o,p}(i,a.compId,a.type)&&!function(e,t,i){if(!t.compId)return!1;if(e.getComponentById(t.compId))return!1;return e.getSiteAspect("tpaPostMessageAspect").queueMessage({msg:t,response:i}),!0}(i,a,n)){var p=t.fixOldPingPongMessageType(a.type),d=m(a);if(d[p]&&(d[p].call(this,i,a,n),function(t,i){if("registerEventListener"===i.type&&!g(i))return e.includes(c,i.data.eventKey);return!0}(0,a))){var l=i.getComponentById(a.compId);o.sendBIEvent(a,a.origin||"viewer",e.get(l,"props.compData"),s.getClientSpecMap(i),i.reportBI)}}},f=function(t){return function t(i,a){return e.isFunction(i)?e.partial(i,a):e.isObject(i)?e.mapValues(i,function(e){return t(e,a)}):i}({openModal:n.openModal,openPopup:n.openPopup},t)};var v=function(t){var i=this;e.bindAll(this,e.functionsIn(this)),t.registerToMessage(this.handleTPAMessage),t.getSiteData().isInSSR()||t.getSiteData().isAddPanelView||d.api.set("tpaHandlers",f(t)),this._siteAPI=t,this._messageQueue=[],t.registerToOnFullyRendered(function(){e.forEach(i._messageQueue,function(e){var t=e.msg,a=e.response;h(i._siteAPI,t,a)}),i._messageQueue.length=0})};return v.prototype={handleTPAMessage:function(e){t.handleTPAMessage.call(this,void 0,this._siteAPI,h,e)},sendPostMessage:function(e,i){var a=e.getIframe();if(a)t.callPostMessage(a,i);else if(this._siteAPI.getSiteData().isDebugMode())throw new Error("No iframe found in TPA component",e)},queueMessage:function(e){this._messageQueue.push(e)},callHandler:h},v}),define("tpa/mixins/tpaRuntimeCompMixin",["santaProps"],function(e){"use strict";return{propTypes:{compData:e.Types.Component.compData.isRequired},getOrigComponentId:function(){return this.props.compData.origCompId}}}),define("tpa/components/tpaPopup",["lodash","prop-types","core","utils","compUtils","santaProps","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin","tpa/utils/tpaUtils"],function(e,t,i,a,n,s,o,r,p,c,d){"use strict";var l=i.compRegistrar,u=function(t){return e.parseInt((t||"").toString().split("px")[0])},g="FIXED",m="ABSOLUTE",h="RELATIVE",f="DEFAULT",v="BOTTOM_CENTER",I="BOTTOM_LEFT",y="BOTTOM_RIGHT",S="CENTER",P="CENTER_LEFT",A="CENTER_RIGHT",T="TOP_CENTER",w="TOP_LEFT",C="TOP_RIGHT",D=function(e,t,i){return e+t/2-i/2},b=function(e,t,i){return e-(t+i)},M=function(e,t,i){return e-(t+i)},E=function(e,t,i){return e+t/2-i/2},_=function(t){var i=0,a="";if(e.isNumber(t))i=t;else if(e.isString(t)){var n=(r=t,/(%)$/.exec(r)),s=(o=t,/^([0-9]+)/.exec(o));i=s&&s[1]?parseInt(s[1],10):0,n&&n[1]&&(a=n[1])}var o,r;return{size:i,unit:a}},x=function(t,i,a,n,s){var o={};return t.origin!==f&&t.origin!==g||(o=function(t,i,a,n){var s={position:"fixed",display:"block",width:a,height:n};return"%"===(n=_(n)).unit?n.size=e.min([n.size,100]):n.size>i.height&&(n.unit="%",n.size=100),(a=_(a)).size="%"===a.unit?e.min([a.size,100]):e.min([a.size,i.width]),t.placement===S?e.assign(s,{marginLeft:a.size/-2+(a.unit||"px"),marginTop:"%"===n.unit?0:n.size/-2+(n.unit||"px"),left:"50%",top:"%"===n.unit?0:"50%"}):t.placement===w?e.assign(s,{left:"0px",top:"0px"}):t.placement===C?e.assign(s,{right:"0px",top:"0px"}):t.placement===T?e.assign(s,{marginLeft:a.size/-2+(a.unit||"px"),top:"0px",left:"50%"}):t.placement===A?e.assign(s,{marginTop:"%"===n.unit?0:n.size/-2+(n.unit||"px"),top:"%"===n.unit?0:"50%",right:"0px"}):t.placement===P?e.assign(s,{marginTop:"%"===n.unit?0:n.size/-2+(n.unit||"px"),top:"%"===n.unit?0:"50%",left:"0px"}):t.placement===I?e.assign(s,{bottom:"0px",left:"0px"}):t.placement===y?e.assign(s,{bottom:"0px",right:"0px"}):t.placement===v&&e.assign(s,{marginLeft:a.size/-2+(a.unit||"px"),left:"50%",bottom:"0px"}),""===n.unit&&(n.unit="px"),""===a.unit&&(a.unit="px"),e.assign(s,{height:n.size+n.unit,width:a.size+a.unit}),s}(t,a,n,s)),t.origin===h&&(o=function(t,i,a,n,s){var o=void 0,r=void 0;return t.placement===S?(n=e.min([n,a.height]),s=e.min([s,a.width]),o=E(i.top,i.height,n),r=D(i.left,i.width,s)):t.placement===w?(n=e.min([n,i.top]),s=e.min([s,i.left]),o=i.top-n,r=i.left-s):t.placement===C?(n=e.min([n,i.top]),s=e.min([s,M(a.width,i.width,i.left)]),o=i.top-n,r=i.width+i.left):t.placement===T?(n=e.min([n,i.top]),s=e.min([s,a.width]),o=i.top-n,r=D(i.left,i.width,s)):t.placement===A?(n=e.min([n,a.height]),s=e.min([s,M(a.width,i.width,i.left)]),o=E(i.top,i.height,n),r=i.width+i.left):t.placement===P?(n=e.min([n,a.height]),s=e.min([s,i.left]),o=E(i.top,i.height,n),r=i.left-s):t.placement===I?(n=e.min([n,b(a.height,i.top,i.height)]),s=e.min([s,i.left]),o=i.top+i.height,r=i.left-s):t.placement===y?(n=e.min([n,b(a.height,i.top,i.height)]),s=e.min([s,M(a.width,i.width,i.left)]),o=i.top+i.height,r=i.width+i.left):t.placement===v&&(n=e.min([n,b(a.height,i.top,i.height)]),s=e.min([s,a.width]),o=i.top+i.height,r=D(i.left,i.width,s)),o=e.max([0,o]),r=e.max([0,r]),e.assign({position:"absolute",display:"block"},{top:o,left:r,width:s,height:n})}(t,i,a,s,n)),t.origin===m&&(o=function(t,i,a,n,s){var o=void 0,r=void 0,p=void 0,c=void 0;return t.placement===S?(p=e.min([i.actualTop+t.y,a.height-(i.actualTop+t.y)]),n=e.min([n,2*p]),c=e.min([i.actualLeft+t.x,a.width-(i.actualLeft+t.x)]),s=e.min([s,2*c]),o=i.top+t.y-n/2,r=i.left+t.x-s/2):t.placement===w?(n=e.min([n,i.actualTop+t.y]),s=e.min([s,i.actualLeft+t.x]),o=i.top+t.y-n,r=i.left+t.x-s):t.placement===C?(n=e.min([n,i.actualTop+t.y]),s=e.min([s,a.width-(i.actualLeft+t.x)]),o=i.top+t.y-n,r=i.left+t.x):t.placement===T?(n=e.min([n,i.actualTop+t.y]),c=e.min([i.actualLeft+t.x,a.width-(i.actualLeft+t.x)]),s=e.min([s,2*c]),o=i.top+t.y-n,r=i.left+t.x-s/2):t.placement===A?(p=e.min([i.actualTop+t.y,a.height-(i.actualTop+t.y)]),n=e.min([n,2*p]),s=e.min([s,a.width-(i.actualLeft+t.x)]),o=i.top+t.y-n/2,r=i.left+t.x):t.placement===P?(p=e.min([i.actualTop+t.y,a.height-(i.actualTop+t.y)]),n=e.min([n,2*p]),s=e.min([s,i.actualLeft+t.x]),o=i.top+t.y-n/2,r=i.left+t.x-s):t.placement===I?(n=e.min([n,a.height-(i.actulaTop+t.y)]),s=e.min([s,i.actualLeft+t.x]),o=i.top+t.y,r=i.left+t.x-s):t.placement===y?(n=e.min([n,a.height-(i.actualTop+t.y)]),s=e.min([s,a.width-(i.actualLeft+t.x)]),o=i.top+t.y,r=i.left+t.x):t.placement===v&&(n=e.min([n,a.height-(i.actualTop+t.y)]),c=e.min([i.actualLeft+t.x,a.width-(i.actualLeft+t.x)]),s=e.min([s,2*c]),o=i.top+t.y,r=i.left+t.x-s/2),o=e.max([0,o]),r=e.max([0,r]),e.assign({position:"absolute",display:"block"},{top:o,left:r,width:s,height:n})}(t,i,a,s,n)),o=function(t,i,a,n){var s=u(n.width),o=u(n.height);if(s<10||o<10){var r=_(a);r.size="%"===r.unit?e.min([r.size,100]):e.min([r.size,t.height]);var p=_(i);return p.size="%"===p.unit?e.min([p.size,100]):e.min([p.size,t.width]),{position:"fixed",display:"block",width:p.size+(r.unit||"px"),height:r.size+(p.unit||"px"),marginLeft:p.size/-2+(r.unit||"px"),marginTop:r.size/-2+(p.unit||"px"),left:"50%",top:"50%"}}return n}(a,n,s,o)},R={displayName:"TPAPopup",mixins:[i.compMixins.skinBasedComp,o,r,p,c],propTypes:{compData:s.Types.Component.compData.isRequired,dynamicClientSpecMapAspect:s.Types.SiteAspects.dynamicClientSpecMapAspect.isRequired,clientSpecMap:s.Types.RendererModel.clientSpecMap.isRequired,siteScrollingBlocker:s.Types.SiteAspects.siteScrollingBlocker.isRequired,id:s.Types.Component.id.isRequired,aspectData:s.Types.TPA.data.isRequired,onCloseCallback:t.func,removePopup:s.Types.TPA.removePopup.isRequired,isMobileView:s.Types.isMobileView.isRequired},statics:{useSantaTypes:!0},getInitialState:function(){return{showComponent:!0,initialInstance:this.props.dynamicClientSpecMapAspect.getAppInstance(this.props.compData.applicationId)||this.getAppData(this).instance,registeredEvents:[]}},getSkinProperties:function(){var e=this.state.showComponent?this.getSelfStyle():{display:"none"},t=this.isBareTheme()?"none":"block";return this.state.showComponent?{"":{style:e},closeButton:{onClick:this.hide,style:{display:t}},iframe:{"data-src":this.buildUrl(this.props.compData.url),scrolling:"no",frameBorder:"0",allow:d.getIFramePermissions(),allowtransparency:"true",allowFullScreen:!0,name:this.props.id}}:{"":{style:e}}},mutateIframeUrlQueryParam:function(e){return e.origCompId=this.props.compData.origCompId,e},getPopupWidth:function(){return e.isUndefined(this.state.width)?this.props.compData.width:this.state.width},getPopupHeight:function(){return e.isUndefined(this.state.height)?this.props.compData.height:this.state.height},getSelfStyle:function(){var t=e.defaults(this.props.compData.position,{x:0,y:0}),i=this.props.compData.origCompStyle,a=this.props.compData.windowSize,n=x(t,i,a,this.getPopupWidth(),this.getPopupHeight());n.zIndex=(s=this.props.aspectData,s.isModalOpen?1001:null);var s;this.shouldDisableScroll=(o=n.height,r=n.width,p=a,"100%"===o&&("100%"===r||Number(u(r))>=p.width)&&this.props.isMobileView);var o,r,p;return this.getThemeStyle(n)},getThemeStyle:function(t){return this.isBareTheme()?e.merge(t,{background:"none",boxShadow:"none",borderRadius:0}):t},hide:function(t,i){var a=this;this.setState({showComponent:!1},function(){var n=t&&t.message?t:void 0;a.props.onCloseCallback&&a.props.onCloseCallback(n),this.props.removePopup(a),e.isFunction(i)&&i()})},isBareTheme:function(){return"BARE"===this.props.compData.theme},componentWillReceiveProps:function(t){var i=e.get(this.props.clientSpecMap,[this.props.compData.applicationId,"instance"]),a=e.get(t.clientSpecMap,[this.props.compData.applicationId,"instance"]);i!==a&&this.setState({initialInstance:a})},componentDidMount:function(){this.props.siteScrollingBlocker.setSiteScrollingBlocked(this,this.shouldDisableScroll)},componentDidUpdate:function(){this.props.siteScrollingBlocker.setSiteScrollingBlocked(this,this.shouldDisableScroll)},componentWillUnmount:function(){this.props.siteScrollingBlocker.setSiteScrollingBlocked(this,!1)}};return l.register("wysiwyg.viewer.components.tpapps.TPAPopup",R),R}),define("tpa/aspects/TPAPopupAspect",["lodash","utils","tpa/components/tpaPopup"],function(e,t){"use strict";var i="tpaPopupAspect";function a(e){return e.getAspectGlobalData(i)}function n(t){return t&&e.isArray(t)&&t.length>0}function s(t){this.aspectSiteApi=t,e.bindAll(this,e.functionsIn(this)),this.aspectSiteApi.registerToUrlPageChange(this.removeAllPopups)}return s.prototype={getComponentsToRender:function(){var t=a(this.aspectSiteApi);return n(t)?e.map(t,function(e){return{structure:e.structure,props:{compData:e.popupData,onCloseCallback:e.popupOnClose}}}):null},showPopup:function(e,s){var o={structure:{componentType:"wysiwyg.viewer.components.tpapps.TPAPopup",type:"Component",id:t.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAPopupSkin",styleId:""},popupData:e,popupOnClose:s},r=a(this.aspectSiteApi);n(r)||(r=[]),r.push(o),this.aspectSiteApi.setAspectGlobalData(i,r),this.aspectSiteApi.forceUpdate()},removePopup:function(t){var s=t.props.id,o=a(this.aspectSiteApi);n(o)&&(o=e.reject(o,{structure:{id:s}}),this.aspectSiteApi.setAspectGlobalData(i,o),this.aspectSiteApi.forceUpdate())},removeAllPopups:function(){n(a(this.aspectSiteApi))&&(this.aspectSiteApi.setAspectGlobalData(i,[]),this.aspectSiteApi.forceUpdate())}},s}),define("tpa/classes/PubSubHub",["lodash","utils"],function(e,t){"use strict";var i=function(e){this.hub=e||{}};return i.prototype={persistData:function(e,i,a,n){var s={data:n,name:i,origin:a},o=this._addEvent(e,i);o.data.length>=1e3&&(t.log.warn("You have exceeded the data limit, and some of the data will be lost! Please make sure you are not persisting unneeded data."),o.data.shift()),o.data.push(s)},addEventListener:function(t,i,a){var n=this._addEvent(t,i);e.includes(n.listeners,a)||n.listeners.push(a)},removeEventListener:function(t,i,a){var n=this._getEvent(t,i);n&&(n.listeners=e.without(n.listeners,a))},getPersistedData:function(e,t){var i=this._getEvent(e,t);return i&&i.data},getEventListeners:function(e,t){var i=this._getEvent(e,t);return i&&i.listeners},deleteCompListeners:function(t,i){var a=this,n=this._getAppEvents(t);e.forOwn(n,function(e,n){a.removeEventListener(t,n,i)})},_addEvent:function(e,t){var i=this.hub[e];i||(i=this.hub[e]={});var a=i[t];return a||(a=i[t]={data:[],listeners:[]}),a},_getEvent:function(e,t){var i=this.hub[e];if(i)return i[t]},_getAppEvents:function(e){return this.hub[e]}},i}),define("tpa/aspects/TPAPubSubAspect",["lodash","tpa/utils/tpaUtils","tpa/classes/PubSubHub"],function(e,t,i){"use strict";var a=function(t){this.aspectSiteAPI=t,this.hub=new i,e.bindAll(this,e.functionsIn(this))};return a.prototype={publish:function(i,a,n){var s=n.eventKey,o=n.isPersistent,r=this.hub.getEventListeners(i,s),p={eventType:t.addPubSubEventPrefix(s),intent:"addEventListener",params:{data:n.eventData,name:s,origin:a}};if(e.forEach(r,function(e){this._sendDataToComp(e,p)}.bind(this)),o){var c=n.eventData;this.hub.persistData(i,s,a,c)}},subscribe:function(i){var a=i.compId,n=i.data,s=t.stripPubSubPrefix(n.eventKey),o=n.receivePastEvents,r=t.getAppDefId(this.aspectSiteAPI,a);if(this.hub.addEventListener(r,s,a),o){var p=this.hub.getPersistedData(r,s);if(!e.isEmpty(p)){var c={intent:"TPA_RESPONSE",compId:a,callId:i.callId,type:i.type,status:!0,res:{drain:!0,data:p}};this._sendDataToComp(a,c)}}},unsubscribe:function(e,t,i){this.hub.getEventListeners(e,i)&&this.hub.removeEventListener(e,i,t)},deleteCompListeners:function(e,t){this.hub.deleteCompListeners(e,t)},_sendDataToComp:function(e,t){var i=this.aspectSiteAPI.getComponentById(e);i&&i.sendPostMessage(t)}},a}),define("tpa/aspects/TPAPixelTrackerAspect",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(e,t,i){"use strict";var a=t.urlUtils,n=t.throttleUtils.throttledForEach,s=function(){var t,s=this._aspectSiteAPI.getPageUrl.bind(this._aspectSiteAPI),r=(t=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e.filter(t,function(t){return e.isString(t.pixelUrl)&&t.permissions&&!t.permissions.revoked})),p=e.map(r,function(e){return new i(e.pixelUrl).addMultipleQueryParams({instance:e.instance,page:s(),ck:a.cacheKiller()}).build()});n(p,o.sendRequest,o.CHUNK_SIZE,o.CHUNK_INTERVAL)};function o(e){this._aspectSiteAPI=e,this._aspectSiteAPI.registerToComponentDidMount(s.bind(this)),this._aspectSiteAPI.registerToUrlPageChange(s.bind(this))}return o.sendRequest=function(e){new window.Image(0,0).src=e},o.CHUNK_SIZE=1,o.CHUNK_INTERVAL=100,o}),define("tpa/components/tpaModal",["lodash","zepto","prop-types","compUtils","core","santaProps","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin","tpa/utils/tpaUtils"],function(e,t,i,a,n,s,o,r,p,c,d){"use strict";var l=n.compRegistrar,u=n.compMixins,g={displayName:"TPAModal",propTypes:{compData:s.Types.Component.compData.isRequired,dynamicClientSpecMapAspect:s.Types.SiteAspects.dynamicClientSpecMapAspect.isRequired,clientSpecMap:s.Types.RendererModel.clientSpecMap.isRequired,windowResizeEvent:s.Types.SiteAspects.windowResizeEvent.isRequired,id:s.Types.Component.id.isRequired,isMobileView:s.Types.isMobileView.isRequired,removeModal:s.Types.TPA.removeModal.isRequired,exitFullScreenMode:s.Types.exitFullScreenMode.isRequired,onCloseCallback:i.func},statics:{useSantaTypes:!0},mixins:[u.skinBasedComp,o,r,p,c,u.blockOuterScrollMixin],getInitialState:function(){return this.props.windowResizeEvent.registerToResize(this),{showComponent:!0,registeredEvents:[],initialInstance:this.props.dynamicClientSpecMapAspect.getAppInstance(this.props.compData.applicationId)||this.getAppData(this).instance,$displayDevice:this.getDeviceType(),windowSize:this.props.compData.windowSize}},componentWillReceiveProps:function(t){var i=e.get(this.props.clientSpecMap,[this.props.compData.applicationId,"instance"]),a=e.get(t.clientSpecMap,[this.props.compData.applicationId,"instance"]);i!==a&&this.setState({initialInstance:a})},getDefaultProperties:function(){return{"":{style:{position:"fixed",display:"block"},onWheel:this.blockOuterScroll},blockingLayer:{onClick:this.hide},frameWrap:{style:this.getIframeWrapperStyle()},dialog:{style:this.getDialogStyle()},xButton:{children:"×",onClick:this.hide,style:{display:"block"}},iframe:{"data-src":this.buildUrl(this.props.compData.url),frameBorder:"0",allow:d.getIFramePermissions(),allowtransparency:"true",allowFullScreen:!0,name:this.props.id}}},getHiddenProperties:function(){return{"":{style:{display:"none"}}}},getBareProperties:function(){return e.merge(this.getDefaultProperties(),{frameWrap:{style:{background:"transparent",border:"none"}},xButton:{style:{display:"none"}}})},getSkinProperties:function(){if(this.state.showComponent)switch(this.props.compData.theme){case"BARE":case"LIGHT_BOX":return this.getBareProperties();default:return this.getDefaultProperties()}return this.getHiddenProperties()},getIframeWrapperStyle:function(){var e={};return this.props.isMobileView&&(e={WebkitOverflowScrolling:"touch",overflowY:"scroll"}),e},getDialogStyle:function(){if("mobile"===this.getDeviceType())return{};var t=this.state.windowSize,i=e.isNumber(this.state.width)?this.state.width:this.props.compData.width,a=e.isNumber(this.state.height)?this.state.height:this.props.compData.height;i=Math.min(i,t.width),a=Math.min(a,t.height);if(!this.getAppData().isWixTPA){var n=t.width-50,s=t.height-50;i>=n&&a>=s&&(i=n,a=s)}return{width:i,height:a,marginTop:-a/2,marginLeft:-i/2}},mutateIframeUrlQueryParam:function(e){return e.origCompId=this.props.compData.origCompId,e},hide:function(t,i){var a=this;this.setState({showComponent:!1},function(){var n=t&&t.message?t:void 0;a.props.onCloseCallback&&a.props.onCloseCallback(n),"mobile"===a.state.$displayDevice&&a.props.exitFullScreenMode(),a.props.windowResizeEvent.unregisterToResize(a),a.props.removeModal(a),e.isFunction(i)&&i()})},isBareTheme:function(){return"BARE"===this.props.compData.theme},onResize:function(){var e=t(window);this.setState({windowSize:{width:e.width(),height:e.height()}})}};return l.register("wysiwyg.viewer.components.tpapps.TPAModal",g),g}),define("tpa/aspects/TPAModalAspect",["lodash","utils","tpa/components/tpaModal"],function(e,t,i){"use strict";var a="tpaModalAspect";function n(t){this.aspectSiteApi=t,e.bindAll(this,e.functionsIn(this))}return n.prototype={getComponentsToRender:function(){var t=function(t){var i=t.getAspectGlobalData(a);return e.get(i,"modalStructure")}(this.aspectSiteApi);if(t){var i=this.aspectSiteApi.getAspectGlobalData(a);return[{structure:t,props:{compData:i.modalData,onCloseCallback:i.modalOnClose,key:t.id}}]}return null},showModal:function(e,i){this.aspectSiteApi.getSiteData().isMobileView()&&("LIGHT_BOX"===e.theme?(this.aspectSiteApi.exitFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!0)):(this.aspectSiteApi.enterFullScreenMode({scrollable:!1}),this.aspectSiteApi.setSiteRootHiddenState(!1))),this.aspectSiteApi.setAspectGlobalData(a,{modalStructure:{componentType:"wysiwyg.viewer.components.tpapps.TPAModal",type:"Component",id:t.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAModalSkin"},modalData:e,modalOnClose:i}),this.aspectSiteApi.forceUpdate()},removeModal:function(){this.aspectSiteApi.getSiteData().isMobileView()&&(this.aspectSiteApi.exitFullScreenMode(),this.aspectSiteApi.setSiteRootHiddenState(!1)),this.aspectSiteApi.setAspectGlobalData(a,{modalStructure:null})}},n}),define("tpa/aspects/TPAMobileViewportAspect",["lodash","utils","experiment","tpa/services/clientSpecMapService"],function(e,t,i,a){"use strict";var n="tpaMobileViewportAspect",s=function(t){this.aspectSiteAPI=t,e.bindAll(this,e.functionsIn(this)),this.aspectSiteAPI.registerToSiteReady(this.fixMobileViewportIfNeeded),this.aspectSiteAPI.registerToUrlPageChange(this.fixMobileViewportIfNeeded)};return s.prototype={fixMobileViewportIfNeeded:function(){var e=this.aspectSiteAPI.getSiteData();if(i.isOpen("sv_tpaMobileViewportFix",e)){var s=this.aspectSiteAPI.getAspectGlobalData(n);if(a.isCurrentPageFullResponsive(e)){if(!s||!s.isResponsive){var o={isResponsive:!0};this.aspectSiteAPI.setAspectGlobalData(n,o),t.mobileViewportFixer.fixViewportTag(e,o)}}else s&&s.isResponsive&&(this.aspectSiteAPI.setAspectGlobalData(n,null),t.mobileViewportFixer.fixViewportTag(e,null))}}},s}),define("tpa/aspects/TPACompStateAspect",["lodash"],function(e){"use strict";var t=function(t){this.siteAspectsSiteAPI=t,e.bindAll(this,e.functionsIn(this))};return t.prototype={updateSectionUrlState:function(e,t){var i=this.siteAspectsSiteAPI.getComponentById(e);i&&i.setState({sectionUrlState:t})},updatePushState:function(e,t){var i=this.siteAspectsSiteAPI.getComponentById(e);i&&i.setState({pushState:t})},updateSectionUrlParams:function(e,t){var i=this.siteAspectsSiteAPI.getComponentById(e);i&&i.setState({sectionUrlParams:t})},reportStateChanged:function(e,t){var i=this.siteAspectsSiteAPI.getComponentById(e);i&&i.reportStateChanged(t)}},t}),define("tpa/aspects/TPAComponentsDomAspect",["lodash"],function(e){"use strict";function t(t){this.aspectSiteApi=t,this.aliveTpaComponentPromises={},this.handleComponentIsAlive={},e.bindAll(this,e.functionsIn(this))}return t.prototype={clearComponentIsAlive:function(e){delete this.handleComponentIsAlive[e],delete this.aliveTpaComponentPromises[e]},markComponentIsAlive:function(e){var t,i,a=(t=this.aspectSiteApi,i=e,t.getComponentById(i));this.handleComponentIsAlive[e]?this.handleComponentIsAlive[e](a):this.aliveTpaComponentPromises[e]=Promise.resolve(a)},getComponentWhenReady:function(e){var t=this.aliveTpaComponentPromises;return t[e]=t[e]||new Promise(function(t){this.handleComponentIsAlive[e]=t}.bind(this)),t[e]}},t}),define("tpa/aspects/TPAPageNavigationAspect",["lodash","tpa/common/supportedSiteEvents"],function(e,t){"use strict";var i=function(e,t){this._listeners={},this._siteAPI=e,this._currentPageId=t||this._siteAPI.getSiteData().getCurrentUrlPageId(),this._siteAPI.registerToUrlPageChange(this.notifyPageChanged.bind(this))};return i.prototype={notifyPageChanged:function(){var i=this._siteAPI.getSiteData().getCurrentUrlPageId(),a=this._currentPageId;e.forEach(this._listeners,function(n){e.forEach(n,function(n){var s=n.comp.props.rootId;if(n.comp._isMounted&&(p=n,c=i,d=a,l=s,p.type===t.PAGE_NAVIGATION||p.type===t.PAGE_NAVIGATION_CHANGE||p.type===t.PAGE_NAVIGATION_IN&&l===c||p.type===t.PAGE_NAVIGATION_OUT&&l===d)){var o={toPage:i,fromPage:a,isAppOnPage:s===i,wasAppOnPage:s===a},r=e.get(this._siteAPI.getSiteData().getExistingRootNavigationInfo(i),"routerPublicData");r&&(o.routerData=r),n.comp.sendPostMessage({intent:"addEventListener",eventType:n.type,params:o})}var p,c,d,l}.bind(this))}.bind(this)),this._currentPageId=i},registerToPageChanged:function(e,t){var i=this._listeners[e.props.id];i||(i=this._listeners[e.props.id]=[]),i.push({comp:e,type:t})},unregisterToPageChanged:function(e){delete this._listeners[e.props.id]}},i}),define("tpa/aspects/TPARPCAspect",["lodash","pmrpc","utils","tpa/utils/tpaUtils"],function(e,t,i,a){"use strict";var n,s=void 0,o="tpa_public_api_",r=3e4,p="Widget",c=(n={},_defineProperty(n,"Page",a.isTPASection),_defineProperty(n,p,a.isGluedWidget),n),d={TIMEOUT:"Callback Timeout Expired",COMP_NOT_FOUND:"ComponentId Not Found",APP_NOT_FOUND:"ApplicationId Not Found",COMP_NOT_SUPPORTED:"Component Not Supported"};function l(e){return o+e}function u(t,n){var o=s.getPageData().id,r=i.siteConstants.MASTER_PAGE_ID,p=e.get(a.getAppDataByAppDefinitionId(s,t),"applicationId");if(!p)return{compId:null,error:d.APP_NOT_FOUND};var l=s.getCompsDataOnPage(o).concat(s.getCompsDataOnPage(r)).filter(function(t){return i=t,a=p,e.get(i,"applicationId")===a.toString();var i,a});if(0===l.length)return{compId:null,error:d.COMP_NOT_FOUND};var u=l.filter(function(t){return i=t,a=n,e.get(c,a,function(){return!1})(i);var i,a});return 0===u.length?{compId:null,error:d.COMP_NOT_SUPPORTED}:u.length>1?{compId:null,error:d.COMP_NOT_SUPPORTED}:{compId:e.get(u[0],"compId")}}function g(){return e.get(s.getSiteData().getExistingRootNavigationInfo(),"tpaInnerRoute")}function m(e){return a.isTPASection({componentType:s.getComponentType(e)})}var h=function(){function t(e){var i=this;_classCallCheck(this,t),this.compId=e,this.resolved=!1,this.rejected=!1,this.tpaSectionState=void 0,this.subscribers=[],this.timeoutId=setTimeout(function(){return i.reject()},r)}return _createClass(t,[{key:"resolve",value:function(){this.resolved=!0,this.invokeSubscribers(l(this.compId)),clearTimeout(this.timeoutId),m(this.compId)&&(this.tpaSectionState=g())}},{key:"reject",value:function(){this.rejected=!0,this.invokeSubscribers(null,d.TIMEOUT)}},{key:"reset",value:function(){this.resolved=!1,this.rejected=!1,this.subscribers=[]}},{key:"subscribe",value:function(e){this.subscribers.push(e)}},{key:"invokeSubscribers",value:function(t,i){e.invokeMap(this.subscribers,e.call,null,t,i),this.subscribers=[]}}]),t}();return function(){function e(t){_classCallCheck(this,e),s=t,this.apiStore={}}return _createClass(e,[{key:"registerApi",value:function(e,i){this.apiStore[i]||(this.apiStore[i]=new h(i)),this.apiStore[i].resolve(),t.api.request(l(i),{initiator:e}).then(function(e){return t.api.set(l(i),e)})}},{key:"requireComponentAPI",value:function(e,t){this.apiStore[e]||(this.apiStore[e]=new h(e)),m(e)&&g()!==this.apiStore[e].tpaSectionState&&this.apiStore[e].reset(),this.apiStore[e].resolved?t(l(e)):this.apiStore[e].rejected?t(null,d.TIMEOUT):this.apiStore[e].subscribe(t)}},{key:"requireSingletonAPI",value:function(e,t,i){var a=u(e,t);a.compId?this.requireComponentAPI(a.compId,i):i(null,a.error)}}]),e}()}),define("tpa/aspects/tpaAspectCollector",["core","tpa/aspects/TPAWorkerAspect","tpa/aspects/TPAPostMessageAspect","tpa/aspects/TPAPopupAspect","tpa/aspects/TPAPubSubAspect","tpa/aspects/TPAPixelTrackerAspect","tpa/aspects/TPAModalAspect","tpa/aspects/TPAMobileViewportAspect","tpa/aspects/TPACompStateAspect","tpa/aspects/TPAComponentsDomAspect","tpa/aspects/TPAPageNavigationAspect","tpa/aspects/TPARPCAspect"],function(e,t,i,a,n,s,o,r,p,c,d,l){"use strict";var u=e.siteAspectsRegistry;u.registerSiteAspect("tpaWorkerAspect",t),u.registerSiteAspect("tpaPostMessageAspect",i),u.registerSiteAspect("tpaPopupAspect",a),u.registerSiteAspect("tpaPubSubAspect",n),u.registerSiteAspect("tpaPixelTrackerAspect",s),u.registerSiteAspect("tpaModalAspect",o),u.registerSiteAspect("tpaMobileViewportAspect",r),u.registerSiteAspect("tpaCompStateAspect",p),u.registerSiteAspect("tpaComponentsDomAspect",c),u.registerSiteAspect("tpaPageNavigationAspect",d),u.registerSiteAspect("TPARPCAspect",l)}),define("tpa",["tpa/components/tpaWidget","tpa/components/tpaSection","tpa/components/tpaMultiSection","tpa/components/tpaWorker","tpa/components/tpaGluedWidget","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/layout/tpaLayout","tpa/components/tpaPreloaderOverlay","tpa/components/tpaUnavailableMessageOverlay","tpa/layout/gluedWidgetPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaSectionPatcher","tpa/mixins/tpaCompBaseMixin","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/common/TPAUrlBuilder","tpa/common/TPABaseUrlBuilder","utils","tpa/utils/tpaUtils","tpa/utils/gluedWidgetMeasuringUtils","tpa/services/tpaPreviewEditorCommunicationService","tpa/services/tpaNavigationService","tpa/common/tpaBi","tpa/utils/sitePages","tpa/common/tpaMetaData","skins","tpa/skins/skins.json","tpa/aspects/tpaAspectCollector"],function(e,t,i,a,n,s,o,r,p,c,d,l,u,g,m,h,f,v,I,y,S,P,A,T,w,C,D,b){"use strict";return D.skinsMap.addBatch(b),{widget:e,section:t,multiSection:i,worker:a,gluedWidget:n,gluedWidgetMeasuringUtils:S,tpaMixins:{tpaUrlBuilder:s,tpaCompApi:o,tpaCompBase:g},GluedWidgetPatcher:d,tpaMeasurer:l,tpaSectionPatcher:u,tpaHandlers:h,common:{metaData:C,tpaPostMessageCommon:m,TPAUrlBuilder:f,styleUtils:I.styleUtils,TPABaseUrlBuilder:v,utils:y,bi:T},services:{tpaPreviewEditorCommunicationService:P,tpaNavigationService:A},tpaStyleUtils:I.styleUtils,sitePages:w}});
//# sourceMappingURL=tpa.min.js.map